<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookHook</title>
<style>
:root{
  --bg:#fafafa; --fg:#111; --muted:#666;
  --line:#ececec; --card:#fff; --pill:#f6f6f6;
  --accent:#000; --accentfg:#fff; --gold:#E7C200;
  --good:#0a6a0a; --info:#0a66c2; --warn:#cc8a00;
}
*{box-sizing:border-box} body{margin:0;font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--fg);background:var(--bg)}
.bar{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff}
.brand{display:flex;gap:8px;align-items:center;font-weight:700}
.dot{width:18px;height:18px;border-radius:6px;background:#000;display:inline-block}
.status{display:flex;gap:8px;align-items:center}
.badge{padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fafafa;font-weight:600;font-size:12px}
.badge.gold{background:#fff7cc;border-color:#E7C200}
.wrap{max-width:820px;margin:0 auto;padding:18px 14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 1px 10px rgba(0,0,0,.04)}
h2{margin:0 0 8px}

/* Swipe card */
.swipe{display:grid;grid-template-columns:220px 1fr;gap:14px;align-items:start}
@media (max-width:720px){.swipe{grid-template-columns:1fr}}
.cover{width:100%;aspect-ratio:2/3;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#eee,#dcdcdc);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,.08),0 1px 0 rgba(0,0,0,.04)}
.cover img{width:100%;height:100%;object-fit:cover;display:block}
.title{font-size:22px;line-height:1.25;margin:2px 0 4px}
.authorline{color:var(--muted);margin:0 0 6px}
.chips{display:flex;gap:6px;overflow-x:auto;flex-wrap:nowrap;scrollbar-width:none;margin-top:4px}
.chips::-webkit-scrollbar{display:none}
.chip{padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#f7f7f7;font-size:12px;white-space:nowrap}
.kpis{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.kpi{font-size:12px;padding:4px 8px;border:1px dashed var(--line);border-radius:999px;background:#fff}
.divider{height:1px;background:var(--line);margin:10px 0}
.author{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.link{color:#0a66c2;text-decoration:none}
.rightMeta{display:flex;align-items:center;gap:6px}

/* Buttons */
.btn{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
.btn.good{background:var(--good);color:#fff;border-color:var(--good)}
.btn.info{background:#e8f3ff;color:#0a3d7e;border-color:#bcdcff}
.btn.warn{background:#ffe9b3;color:#422d00;border-color:#ffd35c}
.btn.ghost{background:#fff;border-color:#ddd}
.muted{color:var(--muted);font-size:14px}
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .2s}
.toast.show{opacity:1}

/* Swipe interactions + hint */
.card-gesture{ position:relative; touch-action: pan-y; user-select:none; will-change: transform; }
.badge-swipe{ position:absolute; top:10px; padding:6px 10px; border-radius:8px; font-weight:700; border:2px solid; background:rgba(255,255,255,.9); opacity:0; transition:opacity .15s ease; }
.badge-swipe.want{ right:10px; color:#0a66c2; border-color:#0a66c2; }         /* LEFT  → Want */
.badge-swipe.like{ left:10px; color:var(--good); border-color:var(--good); } /* RIGHT → Reading */
.badge-swipe.read{ left:50%; transform:translateX(-50%); color:#444; border-color:#444;} /* UP → Read */
.legend{display:flex;gap:8px;flex-wrap:wrap;font-size:12px;color:#444;margin-top:6px}
.legend span{padding:2px 6px;border:1px solid var(--line);border-radius:999px;background:#fff}

/* Modal */
.mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px}
.modal{max-width:560px;width:100%;background:#fff;border:1px solid var(--line);border-radius:14px;padding:16px}
.modal h3{margin:0 0 10px}
.field{width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; font:inherit}
select.field{height:40px}

/* Shelf */
.shelf{display:flex;flex-direction:column;gap:10px}
.shelf .item{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff;display:grid;grid-template-columns:56px 1fr;gap:10px}
.shelf .item .thumb{width:56px;aspect-ratio:2/3;border-radius:6px;overflow:hidden;background:#eee}
.shelf .item h4{margin:0 0 4px;font-size:15px}
.small{font-size:12px;color:#555}
.tile-actions{display:flex;gap:6px;flex-wrap:wrap}
</style>
</head>
<body>
<header class="bar">
  <div class="brand"><span class="dot"></span><span>BookHook</span></div>
  <div class="status"><span id="tier" class="badge">Bronze</span><span id="pts" class="badge gold">0 pts</span></div>
</header>

<main class="wrap">
  <!-- Swipe / Discover -->
  <section class="card" id="swipeCard">
    <h2>Discover</h2>
    <div class="legend">
      <span>⬅️ Want to read</span><span>➡️ Reading</span><span>⬆️ Already read (reflect)</span>
    </div>
    <div id="swipe" class="swipe"></div>
  </section>

  <!-- Your Shelf -->
  <section class="card">
    <h2>Your Shelf</h2>
    <div id="shelf" class="shelf"></div>
  </section>
</main>

<!-- Read Reflection Modal -->
<div id="mask" class="mask" role="dialog" aria-modal="true">
  <div class="modal">
    <h3 id="modalTitle">Mark as read</h3>
    <div class="small" id="modalSub" style="margin-bottom:8px"></div>
    <div class="row" style="margin-top:6px">
      <label class="lbl">Mood before</label>
      <select id="moodBefore" class="field">
        <option value="">Select…</option>
        <option>Low</option><option>Medium</option><option>High</option>
      </select>
    </div>
    <div class="row">
      <label class="lbl">Mood after</label>
      <select id="moodAfter" class="field">
        <option value="">Select…</option>
        <option>Low</option><option>Medium</option><option>High</option>
      </select>
    </div>
    <div class="row">
      <label class="lbl">Takeaway</label>
      <textarea id="takeaway" class="field" rows="3" placeholder="What stuck with you?"></textarea>
    </div>
    <div class="row">
      <label class="lbl">LOL / AHA</label>
      <textarea id="aha" class="field" rows="2" placeholder="Funniest moment, biggest aha…"></textarea>
    </div>
    <div class="row" style="justify-content:flex-end;gap:8px">
      <button class="btn ghost" onclick="closeModal()">Cancel</button>
      <button class="btn good" onclick="submitReflection()">Save (+25)</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* --------- Catalog (add/adjust books here) ---------
   IMPORTANT for Amazon images:
   1) Open the Amazon product page.
   2) Tap the cover image → “Open image in new tab” → copy the URL (it begins with https://m.media-amazon.com/images/I/...jpg).
   3) Paste that URL into the 'image:' field below.
----------------------------------------------------- */
const BOOKS = [
  {
    id:"mabunny",
    title:"Magical Adventures of Lori & Bonnie B. Bunny",
    author:"Elaine Blackstien",               // updated author
    vibes:["Inspiring","Playful","Comedic","Uplifting"],
    facts:{pace:"Fast", pages:248, year:2025},
    gold:true,
    image:"https://m.media-amazon.com/images/I/REPLACE_WITH_AMAZON_IMAGE.jpg", // ← paste the real Amazon image URL here
    links:{buy:"#",site:"#"},
    tags:["Family-friendly","Quest"]
  },
  {
    id:"rid",
    title:"The Ridiculous: Book 1",
    author:"Jef & Mindy",
    vibes:["Funny","Satirical","Empowering","Chill","Mindset-shifting"],
    facts:{pace:"Medium", pages:312, year:2024},
    gold:true,
    image:"https://picsum.photos/400/600?random=102",  // swap with real cover when ready
    links:{buy:"#", site:"#"},
    tags:["Sci-Fi Comedy","Feel-good"]
  },
  {
    id:"hab",
    title:"Atomic Habits of the Heart",
    author:"A. North",
    vibes:["Focused","Grounded","Practical","Motivated","Calm"],
    facts:{pace:"Fast", pages:280, year:2019},
    image:"https://picsum.photos/400/600?random=103",
    links:{buy:"#"},
    tags:["Tiny steps","Habit loop"]
  },
  {
    id:"coz",
    title:"Star Soup & Cozy Skies",
    author:"L. Nova",
    vibes:["Calm","Cozy","Comforted","Reflective"],
    facts:{pace:"Slow", pages:220, year:2021},
    image:"https://picsum.photos/400/600?random=104",
    links:{buy:"#"},
    tags:["Soothing","Night read"]
  }
];

/* ---------------- State ---------------- */
const state = {
  pts: Number(localStorage.getItem("bh_pts")||0),
  deck: [], idx: 0,
  shelf: JSON.parse(localStorage.getItem("bh_shelf")||"[]"),
  pendingRead: null
};
function saveShelf(){ localStorage.setItem("bh_shelf", JSON.stringify(state.shelf)); }
function addPts(n){ state.pts+=n; localStorage.setItem("bh_pts",state.pts); document.getElementById("pts").textContent=state.pts+" pts"; }
function toast(msg){ const t=document.getElementById("toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1200); }

/* ---------------- Init ---------------- */
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("pts").textContent = state.pts + " pts";
  // Require real covers
  state.deck = BOOKS.filter(b=>!!b.image);
  showCard();
  renderShelf();
});

/* ---------------- Swipe Card ---------------- */
function current(){ return state.deck[state.idx % state.deck.length]; }
function nextCard(){ state.idx=(state.idx+1)%state.deck.length; showCard(); }

function showCard(){
  const b = current();
  const el = document.getElementById("swipe");
  if(!b){ el.innerHTML='<div class="muted">No books available.</div>'; return; }

  const primary = (b.vibes||[]).slice(0,4);
  const extra = Math.max(0, (b.vibes||[]).length - primary.length + (b.tags||[]).length);
  const kpis = [b.facts?.pace, b.facts?.pages?`${b.facts.pages}p`:null, b.facts?.year?`Since ${b.facts.year}`:null].filter(Boolean);

  el.innerHTML = `
    <div id="card" class="card-gesture swipe" aria-live="polite">
      <div class="cover"><img src="${b.image}" alt="Cover of ${escape(b.title)}"></div>
      <div>
        <div class="rightMeta">
          ${b.gold?'<span class="badge gold">Featured</span>':''}
          <span class="badge gold" id="ptsTop">${state.pts} pts</span>
        </div>
        <div class="title">${escape(b.title)}</div>
        <div class="authorline">by ${escape(b.author)}</div>

        <div class="chips">
          ${primary.map(c=>`<span class="chip">${escape(c)}</span>`).join('')}
          ${extra>0?`<span class="chip">+${extra} more</span>`:''}
        </div>
        <div class="kpis">${kpis.map(x=>`<span class="kpi">${escape(x)}</span>`).join('')}</div>

        <div class="divider"></div>

        <div class="row" style="gap:8px;flex-wrap:wrap">
          <button class="btn info"  onclick="fileWant()">Want (+5)</button>
          <button class="btn good"  onclick="fileReading()">Reading (+7)</button>
          <button class="btn warn"  onclick="openReadModal()">Already read</button>
        </div>

        <div class="divider"></div>
        <div class="author">
          <b>Author</b> · <span class="muted">${escape(b.author)}</span>
          ${b.links?.site?`· <a class="link" href="${b.links.site}">Website</a>`:''}
          ${b.links?.buy?`· <a class="link" href="${b.links.buy}">Buy</a>`:''}
        </div>
      </div>

      <span class="badge-swipe want">WANT</span>
      <span class="badge-swipe like">READING</span>
      <span class="badge-swipe read">READ</span>
    </div>
  `;

  addSwipe(document.getElementById("card"), fileWant, fileReading, openReadModal);
}

/* drag: left=want, right=reading, up=read */
function addSwipe(el, onLeft, onRight, onUp){
  let startX=0,startY=0,dx=0,dy=0,drag=false;
  const want = el.querySelector('.badge-swipe.want');
  const like = el.querySelector('.badge-swipe.like');
  const read = el.querySelector('.badge-swipe.read');

  const down = e=>{ drag=true; startX=e.clientX ?? e.touches?.[0]?.clientX; startY=e.clientY ?? e.touches?.[0]?.clientY; el.style.transition=''; };
  const move = e=>{
    if(!drag) return;
    const x = e.clientX ?? e.touches?.[0]?.clientX; const y = e.clientY ?? e.touches?.[0]?.clientY;
    dx = x - startX; dy = y - startY;
    const rot = dx/14;
    el.style.transform = `translate(${dx}px, ${dy}px) rotate(${rot}deg)`;
    const ax = Math.min(1, Math.abs(dx)/120);
    const ay = Math.min(1, Math.max(0, -dy)/120); // up only
    if(dx<0){ want.style.opacity=ax; like.style.opacity=0; }
    else if(dx>0){ like.style.opacity=ax; want.style.opacity=0; }
    else { want.style.opacity=0; like.style.opacity=0; }
    read.style.opacity = ay;
  };
  const end = ()=>{
    if(!drag) return; drag=false;
    const TH=80, TH_UP=80;
    if(dx < -TH){ fling(-520, 0, -15, onLeft); }
    else if(dx > TH){ fling(520, 0, 15, onRight); }
    else if(-dy > TH_UP){ fling(0, -520, 0, onUp); }
    else { snap(); }
  };
  const snap = ()=>{ el.style.transition='transform .2s'; el.style.transform='translate(0,0) rotate(0)'; want.style.opacity=0; like.style.opacity=0; read.style.opacity=0; };
  const fling=(tx,ty,rot,cb)=>{ el.style.transition='transform .2s'; el.style.transform=`translate(${tx}px,${ty}px) rotate(${rot}deg)`; setTimeout(cb,160); };

  el.addEventListener('pointerdown',down);
  el.addEventListener('pointermove',move);
  el.addEventListener('pointerup',end);
  el.addEventListener('pointercancel',end);
}

/* filing actions + shelf */
function ensureOnShelf(book){
  let it = state.shelf.find(x=>x.id===book.id);
  if(!it){ it={id:book.id,title:book.title,author:book.author,image:book.image,status:'want'}; state.shelf.unshift(it); saveShelf(); }
  return it;
}
function fileWant(){ const b=current(); const it=ensureOnShelf(b); it.status='want'; saveShelf(); addPts(5); toast('Saved to Want. Come back to reflect when you finish!'); nextCard(); renderShelf(); }
function fileReading(){ const b=current(); const it=ensureOnShelf(b); it.status='reading'; saveShelf(); addPts(7); toast('Marked as Reading. Come back to reflect when you finish!'); nextCard(); renderShelf(); }
function openReadModal(fromShelfId=null){
  const b = fromShelfId ? state.shelf.find(x=>x.id===fromShelfId) : ensureOnShelf(current());
  state.pendingRead = b;
  document.getElementById('modalTitle').textContent = `Mark as read: ${b.title}`;
  document.getElementById('modalSub').textContent = 'Share how it changed you — this helps future matches.';
  document.getElementById('moodBefore').value='';
  document.getElementById('moodAfter').value='';
  document.getElementById('takeaway').value='';
  document.getElementById('aha').value='';
  document.getElementById('mask').style.display='flex';
}
function closeModal(){ document.getElementById('mask').style.display='none'; state.pendingRead=null; }
function submitReflection(){
  const before = document.getElementById('moodBefore').value;
  const after  = document.getElementById('moodAfter').value;
  const takeaway = document.getElementById('takeaway').value.trim();
  const aha = document.getElementById('aha').value.trim();
  if(!before || !after){ toast('Please select mood before & after.'); return; }
  const b = state.pendingRead;
  const it = ensureOnShelf(b);
  it.status='read';
  it.reflection = {before,after,takeaway,aha,ts:Date.now()};
  saveShelf(); addPts(25); toast('Saved! Thanks for reflecting 🙌');
  closeModal(); nextCard(); renderShelf();
}

function renderShelf(){
  const shelf = document.getElementById('shelf');
  if(!state.shelf.length){ shelf.innerHTML='<div class="muted">Your shelf is empty. Swipe some books!</div>'; return; }
  shelf.innerHTML = state.shelf.map(it=>`
    <div class="item">
      <div class="thumb">${it.image?`<img src="${it.image}" alt="">`:''}</div>
      <div>
        <h4>${escape(it.title)}</h4>
        <div class="small">by ${escape(it.author)} · <b>${it.status}</b></div>
        <div class="tile-actions" style="margin-top:6px">
          ${it.status!=='read'?`<button class="btn good" onclick="openReadModal('${it.id}')">Mark read</button>`:''}
          ${it.status==='read'?`<button class="btn ghost" onclick="openReadModal('${it.id}')">Reflect</button>`:''}
          <button class="btn ghost" onclick="removeFromShelf('${it.id}')">Remove</button>
        </div>
        ${it.reflection? renderReflection(it.reflection) : ''}
      </div>
    </div>
  `).join('');
}
function renderReflection(r){
  return `<div class="small" style="margin-top:6px">
    <div><b>Mood</b> before → after: ${escape(r.before)} → ${escape(r.after)}</div>
    ${r.takeaway?`<div><b>Takeaway:</b> ${escape(r.takeaway)}</div>`:''}
    ${r.aha?`<div><b>LOL/AHA:</b> ${escape(r.aha)}</div>`:''}
  </div>`;
}
function removeFromShelf(id){ state.shelf = state.shelf.filter(x=>x.id!==id); saveShelf(); renderShelf(); }

/* Utils */
function escape(s){return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]))}
</script>
</body>
</html>

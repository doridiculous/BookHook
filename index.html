<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookHook</title>

<style>
  :root{
    --bg:#f7f7f8; --fg:#111; --muted:#666;
    --line:#e9e9ee; --card:#fff; --pill:#f4f4f6;
    --accent:#000; --accentfg:#fff; --gold:#E7C200; --gold-ink:#2b2100;
    --ok:#0a7e26; --nope:#c41c1c; --ring:rgba(0,0,0,.06);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);
       font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:18px 14px}
  /* Top bar (points) */
  .bar{display:flex;justify-content:flex-end;align-items:center;
       padding:8px 14px;border-bottom:1px solid var(--line);background:#fff;position:sticky;top:0;z-index:3}
  .badge{padding:5px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;font-weight:600;font-size:12px}
  .badge.gold{background:#fff7cc;border-color:#E7C200}
  /* Hero with centered logo */
  .hero{display:flex;flex-direction:column;align-items:center;gap:10px;padding:28px 12px}
  .hero .logo{height:64px;display:block}
  .hero .brand{font-weight:800;font-size:22px}
  .rot{min-height:22px;font-weight:600;color:#222;text-align:center}
  .rot small{color:#777;font-weight:500}
  /* Cards */
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:14px 0;
        box-shadow:0 6px 24px var(--ring)}
  h2{margin:0 0 10px}
  .muted{color:var(--muted);font-size:14px}

  /* Pills */
  .pills{display:flex;flex-wrap:wrap;gap:8px}
  .pill{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:var(--pill);cursor:pointer}
  .pill.on{background:#000;color:#fff;border-color:#000}

  .btn{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
  .btn.gold{background:var(--gold);border-color:#caa900;color:#000}
  .btn.ok{background:#eaf8ed;border-color:#b8e4c3;color:#0f6c25}
  .btn.nope{background:#fde9ea;border-color:#f5c4c8;color:#a01515}

  /* Swipe card layout */
  .swipe{display:grid;grid-template-columns:210px 1fr;gap:16px}
  @media (max-width:740px){.swipe{grid-template-columns:1fr}}
  .cover{width:100%;aspect-ratio:2/3;border-radius:12px;overflow:hidden;background:#ddd;
         display:flex;align-items:center;justify-content:center;font-weight:800;font-size:48px}
  .cover img{width:100%;height:100%;object-fit:cover;display:block}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fafafa;font-size:13px}
  .bar-mini{display:flex;gap:8px;margin-bottom:8px}
  .tab{padding:6px 10px;border-radius:999px;border:1px solid var(--line);font-weight:600;font-size:12px;background:#fff}
  .tab.hint{background:#fff7cc;border-color:#E7C200}

  /* Gesture */
  .card-gesture{ position:relative; touch-action: pan-y; user-select:none; will-change: transform; }
  .badge-swipe{ position:absolute; top:10px; padding:6px 10px; border-radius:8px; font-weight:700; border:2px solid; background:rgba(255,255,255,.9); opacity:0; transition:opacity .15s ease; }
  .badge-swipe.like{ left:14px; color:var(--ok); border-color:var(--ok); }
  .badge-swipe.nope{ right:14px; color:var(--nope); border-color:var(--nope); }

  /* Inputs */
  .field{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font:inherit}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}

  /* Shelf */
  .list{display:flex;flex-direction:column;gap:10px}
  .tile{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;padding:10px;border:1px solid var(--line);border-radius:12px;background:#fff}
  .tile .thumb{width:64px;height:96px;border-radius:8px;background:#eee;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .stat{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#f6f6f6;font-size:12px}
  .stat.want{background:#eef3ff;border-color:#cfe1ff}
  .stat.reading{background:#eaf8ed;border-color:#b8e4c3}
  .stat.read{background:#fff0d2;border-color:#f7dc8a}
</style>
</head>
<body>

  <!-- Points/status bar -->
  <div class="bar">
    <span id="tier" class="badge">Bronze</span>
    <span id="pts" class="badge gold" style="margin-left:8px">0 pts</span>
  </div>

  <!-- Centered logo + rotating tagline -->
  <header class="hero">
    <!-- If you uploaded assets/logo.png, this will show. Otherwise text fallback appears. -->
    <img src="assets/logo.png" alt="BookHook logo" class="logo" onerror="this.replaceWith(Object.assign(document.createElement('div'),{textContent:'BookHook',className:'brand'}));">
    <div class="rot" id="rotTag"></div>
  </header>

  <main class="wrap">

    <!-- Discover -->
    <section class="card" id="swipeCard">
      <div class="bar-mini">
        <span class="tab hint">Dream Big · Do Ridiculous · Achieve Remarkable</span>
        <span class="tab">Swipe left: Want</span>
        <span class="tab">Swipe right: Reading</span>
        <span class="tab">Tap “Already read” to reflect</span>
      </div>
      <div id="swipe" class="swipe"></div>
    </section>

    <!-- Quick Mood setup (kept simple & compact) -->
    <section class="card">
      <h2>Your Mood & Goal</h2>
      <div class="row">
        <b>Before reading:</b>
        <div id="moodBefore" class="pills" aria-label="mood before"></div>
      </div>
      <div class="row">
        <b>Desired mood:</b>
        <div id="desiredMood" class="pills" aria-label="desired mood"></div>
      </div>
      <div class="muted">Tip: these choices nudge the match score above.</div>
    </section>

    <!-- Reflection (appears after “Already read”) -->
    <section class="card" id="reflectCard" style="display:none">
      <h2>Share your takeaway</h2>
      <div class="muted" id="reflectTitle"></div>
      <div class="row"><b>Mood after:</b>
        <div id="moodAfter" class="pills" aria-label="mood after"></div>
      </div>
      <textarea id="reflectText" class="field" rows="4" placeholder="Any laughs, AHAs, mindset shifts, or feelings you want to remember?"></textarea>
      <div class="row">
        <button class="btn" onclick="cancelReflect()">Cancel</button>
        <button class="btn gold" onclick="submitReflect()">Save reflection (+10)</button>
      </div>
      <div class="muted" id="reflectNote"></div>
    </section>

    <!-- Your Shelf -->
    <section class="card">
      <h2>Your Shelf</h2>
      <div id="shelf" class="list"></div>
      <div class="muted" id="shelfEmpty">Save or swipe to add books here.</div>
    </section>

    <!-- Profiles -->
    <section class="card">
      <h2>Profiles</h2>
      <div class="row">
        <label><input type="checkbox" id="isReader"> Reader</label>
        <label><input type="checkbox" id="isAuthor"> Author</label>
        <button class="btn" onclick="saveProfile()">Save</button>
      </div>
      <div class="row">
        <span class="stat want">Want: <b id="statWant">0</b></span>
        <span class="stat reading">Reading: <b id="statReading">0</b></span>
        <span class="stat read">Read: <b id="statRead">0</b></span>
        <span class="stat">Rated: <b id="statRated">0</b></span>
      </div>
      <div class="muted">Profiles show if you’re a Reader and/or Author, and your activity stats (auto-calculated).</div>
    </section>

  </main>

<script>
/* -------------------- Brand taglines (rotate) -------------------- */
const taglines = [
  "Hook the right book for your mood.",
  "Swipe · Match · Read · Transform.",
  "Find books by how you want to feel.",
  "Dream Big · Do Ridiculous · Achieve Remarkable."
];
let t = 0;
function rotateTag(){ const el = document.getElementById('rotTag'); if(!el) return;
  el.innerHTML = `<small>${taglines[t]}</small>`; t=(t+1)%taglines.length;
}
rotateTag(); setInterval(rotateTag, 3000);

/* -------------------- Data -------------------- */
const MOOD = ["Low","Medium","High"];
const DESIRED = ["Restful","Reflective","Insightful","Empowering","Intriguing","Educational","Comedic","Silly","Inspiring","Arousing","Uplifting","Self-loving","Entrepreneurial"];

/* Book catalog. TIP: add image: 'https://...' to lock a cover. The card will auto-fetch if missing. */
const BOOKS = [
  {
    id:"rid",
    title:"The Ridiculous: Book 1",
    author:"Jef & Mindy",
    vibes:["Funny","Satirical","Empowering","Chill","Mindset-shifting"],
    facts:{pace:"Medium", pages:312, year:2024},
    gold:true,
    links:{buy:"#", site:"#"},
    tags:["Sci-Fi Comedy","Feel-good"]
    // image: "https://m.media-amazon.com/images/I/xxxxx.jpg"
  },
  {
    id:"mag",
    title:"Magical Adventures of Lori & Bonnie B. Bunny",
    author:"Elaine Blackstien",
    vibes:["Inspiring","Playful","Comedic","Uplifting"],
    facts:{pace:"Fast", pages:248, year:2025},
    gold:true,
    links:{buy:"#", site:"#"},
    tags:["Adventure","Heart"]
  },
  {
    id:"coz",
    title:"Star Soup & Cozy Skies",
    author:"L. Nova",
    vibes:["Calm","Cozy","Comforted","Reflective"],
    facts:{pace:"Slow", pages:220, year:2021},
    links:{buy:"#"},
    tags:["Soothing","Night read"]
  },
  {
    id:"hab",
    title:"Atomic Habits of the Heart",
    author:"A. North",
    vibes:["Focused","Grounded","Practical","Motivated","Calm"],
    facts:{pace:"Fast", pages:280, year:2019},
    links:{buy:"#"},
    tags:["Tiny steps","Habit loop"]
  }
];

/* -------------------- State -------------------- */
const state = {
  moodBefore: new Set(), desired: new Set(), moodAfter: new Set(),
  pts: Number(localStorage.getItem("bh_pts")||0),
  shelf: JSON.parse(localStorage.getItem("bh_shelf")||"[]"), // {id,title,author,image,status:'want'|'reading'|'read'}
  reviews: JSON.parse(localStorage.getItem("bh_reviews")||"[]"), // {id, note, moodAfter}
  order: [],
  reflectingId: null,
  profile: JSON.parse(localStorage.getItem("bh_profile")||'{"isReader":true,"isAuthor":false}')
};

/* -------------------- Init -------------------- */
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("pts").textContent = state.pts + " pts";
  // Pills
  renderPills("moodBefore", MOOD, state.moodBefore, refreshMatchesSingle);
  renderPills("desiredMood", DESIRED, state.desired, refreshMatchesSingle);
  renderPills("moodAfter", MOOD, state.moodAfter); // used only in reflection
  // Profile toggles
  document.getElementById("isReader").checked = !!state.profile.isReader;
  document.getElementById("isAuthor").checked = !!state.profile.isAuthor;
  // Prefetch/resolve covers, then show the first swipe
  prefetchCovers().then(()=>{ refreshMatchesSingle(); show(0); });
  renderShelf(); updateStats();
});

/* -------------------- UI helpers -------------------- */
function renderPills(containerId, items, set, onChange){
  const box = document.getElementById(containerId); box.innerHTML = "";
  items.forEach(name => {
    const b = document.createElement("button");
    b.className = "pill"; b.textContent = name;
    if(set.has(name)) b.classList.add("on");
    b.addEventListener("click", () => {
      if(set.has(name)){ set.delete(name); b.classList.remove("on"); }
      else { set.add(name); b.classList.add("on"); }
      if(onChange) onChange();
    });
    box.appendChild(b);
  });
}

/* -------------------- Matching -------------------- */
function score(b){
  // Desired mood vs vibes (1.4x), mood before vs vibes (0.5x), featured bonus
  const inter = (arr,set)=>arr.filter(x=>set.has(x)).length;
  let s = inter(b.vibes||[], state.desired)*1.4 + inter(b.vibes||[], state.moodBefore)*0.5;
  if(b.gold) s += 2.0;
  return s;
}
function refreshMatchesSingle(){
  // Only consider books that have an image (no placeholder in rotation)
  const withImg = BOOKS.filter(b=>b.image);
  state.order = [...withImg].sort((a,b)=>score(b)-score(a));
  if(!state.order.length){
    // If none have a known image yet, show the highest while cover fetch happens.
    state.order = [...BOOKS].sort((a,b)=>score(b)-score(a));
  }
  show(0);
}

/* -------------------- Swipe Card -------------------- */
function show(idx){
  if(state.order.length===0){ document.getElementById("swipe").innerHTML='<div class="muted">No books yet.</div>'; return; }
  const b = state.order[idx%state.order.length];
  const el = document.getElementById("swipe");

  const chips = [
    ...(b.vibes||[]).slice(0,4),
    b.facts?.pace,
    b.facts?.pages ? `${b.facts.pages}p` : null,
    b.facts?.year ? `Since ${b.facts.year}` : null,
    ...(b.tags||[]).slice(0,2)
  ].filter(Boolean);

  const coverHTML = b.image
    ? `<div class="cover"><img src="${b.image}" alt="Cover of ${escapeHtml(b.title)}"></div>`
    : `<div class="cover" aria-hidden="true">${b.title.slice(0,1)}</div>`;

  el.innerHTML = `
  <div id="card" class="card-gesture swipe" aria-label="Swipe this card">
    ${coverHTML}
    <div>
      <div class="row" style="justify-content:space-between;align-items:center;margin-top:2px">
        <div class="chips" style="margin-top:0">
          ${b.gold?'<span class="chip" style="background:#fff7cc;border-color:#E7C200">Featured</span>':''}
        </div>
        <div class="badge gold" id="ptsTop">${state.pts} pts</div>
      </div>
      <h2 style="margin:6px 0 2px">${escapeHtml(b.title)}</h2>
      <div class="muted" style="margin-bottom:6px">by ${escapeHtml(b.author)}</div>
      <div class="chips">${chips.map(c=>`<span class="chip">${escapeHtml(c)}</span>`).join('')}</div>
      <div class="row" style="margin-top:10px">
        <button class="btn nope" onclick="decide('want','${b.id}')">Want (+5)</button>
        <button class="btn ok" onclick="decide('reading','${b.id}')">Reading (+7)</button>
        <button class="btn gold" onclick="alreadyRead('${b.id}')">Already read</button>
      </div>
      <div class="muted" style="margin-top:8px">Swipe left = Want · Swipe right = Reading · Tap “Already read” to add a reflection</div>
    </div>
    <span class="badge-swipe like">READING</span>
    <span class="badge-swipe nope">WANT</span>
  </div>`;

  // Attach gesture to the new card
  addSwipe(document.getElementById('card'),
    ()=>decide('want', b.id),
    ()=>decide('reading', b.id)
  );
}

/* Swipe interactions */
function addSwipe(el, onLeft, onRight){
  let startX=0, dx=0, dragging=false, threshold=80;
  const like = el.querySelector('.badge-swipe.like');
  const nope = el.querySelector('.badge-swipe.nope');

  const onDown = (e)=>{ dragging=true; startX=e.clientX??e.touches?.[0]?.clientX; el.style.transition=''; };
  const onMove = (e)=>{
    if(!dragging) return;
    const x=e.clientX??e.touches?.[0]?.clientX; dx=x-startX;
    const rot=dx/12; el.style.transform=`translateX(${dx}px) rotate(${rot}deg)`;
    const a=Math.min(1,Math.abs(dx)/120);
    if(dx>0){ if(like) like.style.opacity=a; if(nope) nope.style.opacity=0; }
    else    { if(nope) nope.style.opacity=a; if(like) like.style.opacity=0; }
  };
  const snap = ()=>{ el.style.transition='transform .2s ease'; el.style.transform='translateX(0) rotate(0)';
    if(like) like.style.opacity=0; if(nope) nope.style.opacity=0; };
  const onUp = ()=>{
    if(!dragging) return; dragging=false;
    if(dx> threshold){ el.style.transition='transform .2s ease'; el.style.transform='translateX(500px) rotate(12deg)'; setTimeout(onRight,160); }
    else if(dx<-threshold){ el.style.transition='transform .2s ease'; el.style.transform='translateX(-500px) rotate(-12deg)'; setTimeout(onLeft,160); }
    else snap();
  };
  el.addEventListener('pointerdown', onDown);
  el.addEventListener('pointermove', onMove);
  el.addEventListener('pointerup', onUp);
  el.addEventListener('pointercancel', onUp);
}

/* Decisions */
function decide(status, id){
  const book = BOOKS.find(x=>x.id===id); if(!book) return;
  if(!state.shelf.find(x=>x.id===id)){
    state.shelf.unshift({id:book.id,title:book.title,author:book.author,image:book.image||null,status});
  }else{
    state.shelf = state.shelf.map(x=>x.id===id?{...x,status}:x);
  }
  persist('bh_shelf', state.shelf);
  renderShelf(); updateStats();
  addPts(status==='reading'?7:5);
  // rotate to next
  const i = state.order.findIndex(x=>x.id===id);
  if(i>-1){ state.order.push(state.order.splice(i,1)[0]); }
  show(0);
}

function alreadyRead(id){
  const book = BOOKS.find(x=>x.id===id); if(!book) return;
  // mark as read on shelf
  if(!state.shelf.find(x=>x.id===id)){
    state.shelf.unshift({id:book.id,title:book.title,author:book.author,image:book.image||null,status:'read'});
  }else{
    state.shelf = state.shelf.map(x=>x.id===id?{...x,status:'read'}:x);
  }
  persist('bh_shelf', state.shelf); renderShelf(); updateStats();
  // open reflection UI
  state.reflectingId = id; state.moodAfter.clear();
  document.getElementById('reflectText').value = "";
  document.getElementById('reflectNote').textContent = "";
  document.getElementById('reflectTitle').textContent = `You read: ${book.title} — share your mood after & a takeaway`;
  document.getElementById('reflectCard').style.display = "";
}

function cancelReflect(){ document.getElementById('reflectCard').style.display="none"; }
function submitReflect(){
  if(!state.reflectingId) return;
  const id = state.reflectingId;
  const mood = [...state.moodAfter][0]||null;
  const note = document.getElementById('reflectText').value.trim();
  state.reviews.push({id, moodAfter:mood, note, ts:Date.now()});
  persist('bh_reviews', state.reviews);
  addPts(10);
  document.getElementById('reflectNote').textContent = "Saved — thanks for sharing!";
  updateStats();
  setTimeout(()=>{ document.getElementById('reflectCard').style.display="none"; }, 600);
}

/* Shelf render */
function renderShelf(){
  const box=document.getElementById('shelf'), empty=document.getElementById('shelfEmpty');
  if(!state.shelf.length){ box.innerHTML=""; empty.style.display=""; return; }
  empty.style.display="none";
  box.innerHTML = state.shelf.map(b=>`
    <div class="tile">
      <div class="thumb">${b.image?`<img src="${b.image}" alt="">`:""}</div>
      <div>
        <div style="font-weight:700">${escapeHtml(b.title)}</div>
        <div class="muted">by ${escapeHtml(b.author)}</div>
        <div class="row" style="margin-top:6px">
          <span class="stat ${b.status}">${b.status}</span>
        </div>
      </div>
      <div class="row">
        ${b.status!=='read'?`<button class="btn gold" onclick="markRead('${b.id}')">Mark read</button>`:""}
        <button class="btn" onclick="removeFromShelf('${b.id}')">Remove</button>
      </div>
    </div>`).join('');
}
function markRead(id){ alreadyRead(id); }
function removeFromShelf(id){
  state.shelf = state.shelf.filter(x=>x.id!==id); persist('bh_shelf', state.shelf);
  renderShelf(); updateStats();
}

/* Profiles */
function saveProfile(){
  state.profile = { isReader: document.getElementById('isReader').checked,
                    isAuthor: document.getElementById('isAuthor').checked };
  persist('bh_profile', state.profile);
}
function updateStats(){
  const want = state.shelf.filter(x=>x.status==='want').length;
  const reading = state.shelf.filter(x=>x.status==='reading').length;
  const read = state.shelf.filter(x=>x.status==='read').length;
  const rated = state.reviews.length;
  document.getElementById('statWant').textContent = want;
  document.getElementById('statReading').textContent = reading;
  document.getElementById('statRead').textContent = read;
  document.getElementById('statRated').textContent = rated;
}

/* Points */
function addPts(n){
  state.pts += n; persist('bh_pts', state.pts);
  document.getElementById("pts").textContent = state.pts + " pts";
  const top = document.getElementById("ptsTop"); if(top) top.textContent = state.pts + " pts";
}

/* Cover fetching (Google Books first, then Open Library if ISBN is present) */
async function prefetchCovers(){
  await Promise.all(BOOKS.map(async b=>{
    if(b.image) return; // skip if provided
    const url = await resolveCover(b);
    if(url) b.image = url;
  }));
}
async function resolveCover(book){
  try{
    const q = encodeURIComponent(`intitle:${book.title} inauthor:${book.author}`);
    const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${q}&maxResults=1`);
    if(res.ok){
      const data = await res.json();
      const img = data?.items?.[0]?.volumeInfo?.imageLinks?.thumbnail
               || data?.items?.[0]?.volumeInfo?.imageLinks?.smallThumbnail;
      if(img) return img.replace('http://','https://');
    }
  }catch(e){/* ignore */}
  if(book.isbn){
    const url = `https://covers.openlibrary.org/b/isbn/${book.isbn}-L.jpg`;
    try{ const head = await fetch(url,{method:'HEAD'}); if(head.ok) return url; }catch(e){}
  }
  return null;
}

/* Utils */
function persist(k,v){ localStorage.setItem(k, typeof v==='string'?v:JSON.stringify(v)); }
function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]))}
</script>
</body>
</html>

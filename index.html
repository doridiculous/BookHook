<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookHook</title>

<style>
:root{
  --bg:#f7f7f8; --fg:#111; --muted:#6b7280;
  --card:#fff; --line:#e5e7eb; --pill:#f5f5f5;
  --accent:#000; --accentfg:#fff; --gold:#E7C200;
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:18px 14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 1px 8px rgba(0,0,0,.03)}
h1,h2{margin:0 0 10px}

/* top bar */
.bar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#fff;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:3}
.nav{display:flex;gap:8px;flex-wrap:wrap}
.nav .btn{font-size:12px;padding:6px 10px}
.badge{padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;font-weight:600;font-size:12px}
.badge.gold{background:#fff7cc;border-color:#E7C200}

/* hero logo + tagline */
.hero{display:flex;flex-direction:column;align-items:center;gap:8px;padding:22px 12px}
.logo{height:54px}
.tag{color:var(--muted);font-weight:600}

/* pills & inputs */
.lbl{min-width:120px;color:var(--muted)}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:8px 0}
.pills{display:flex;flex-wrap:wrap;gap:8px}
.pill{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:var(--pill);cursor:pointer}
.pill.on{background:#111;color:#fff;border-color:#111}
.field{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font:inherit}

/* discover swipe card */
.swipe{display:grid;grid-template-columns:210px 1fr;gap:16px}
@media (max-width:740px){.swipe{grid-template-columns:1fr}}
.cover{width:100%;aspect-ratio:2/3;border-radius:12px;overflow:hidden;background:#e5e7eb;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:48px}
.cover img{width:100%;height:100%;object-fit:cover;display:block}
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;align-items:center}
.chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fafafa;font-size:13px;display:inline-flex}
.actions{display:flex;gap:10px;margin-top:12px}
.btn{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
.btn.gold{background:var(--gold);border-color:#caa900;color:#000}
.muted{color:var(--muted);font-size:14px}
.divider{height:1px;background:var(--line);margin:12px 0}

/* swipe gestures */
.card-gesture{position:relative;touch-action:pan-y;user-select:none;will-change:transform}
.badge-swipe{position:absolute;top:10px;padding:6px 10px;border-radius:8px;font-weight:700;border:2px solid;background:rgba(255,255,255,.9);opacity:0;transition:opacity .15s}
.badge-swipe.like{left:10px;color:#0a6a0a;border-color:#0a6a0a}
.badge-swipe.nope{right:10px;color:#cc1b1b;border-color:#cc1b1b}

/* shelf (small note on home; full list lives on Profile) */
.list{display:flex;flex-direction:column;gap:10px}
.tile{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;padding:10px;border:1px solid var(--line);border-radius:12px;background:#fff}
.tile .thumb{width:64px;height:96px;border-radius:8px;background:#eee;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}
.stat{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#f6f6f6;font-size:12px}
.stat.want{background:#eef3ff;border-color:#cfe1ff}
.stat.reading{background:#eaf8ed;border-color:#b8e4c3}
.stat.read{background:#fff0d2;border-color:#f7dc8a}

/* small helper */
.hint{background:#fff7cc;border:1px solid #E7C200;padding:6px 10px;border-radius:999px;font-weight:600;font-size:12px}
</style>
</head>
<body>
  <!-- Top bar -->
  <header class="bar">
    <div class="nav">
      <button class="btn" onclick="showSection('discover')">Discover</button>
      <button class="btn" onclick="showSection('hookmarks')">HookMarks</button>
      <button class="btn" onclick="showSection('profile')">My Profile</button>
      <button class="btn" onclick="showSection('community')">Community</button>
      <button class="btn" onclick="showSection('leaders')">Leaderboards</button>
    </div>
    <div class="status"><span id="tier" class="badge">Bronze</span><span id="pts" class="badge gold">0 pts</span></div>
  </header>

  <main class="wrap">
    <!-- HERO: inline black logo + rotating taglines -->
    <section class="hero">
      <!-- inline SVG logo (no upload needed) -->
      <svg class="logo" viewBox="0 0 260 60" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="BookHook">
        <rect x="4" y="8" width="44" height="44" rx="10" fill="#111"/>
        <circle cx="26" cy="30" r="9" fill="#fff"/>
        <text x="62" y="39" font-family="SF Pro Text, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif"
              font-weight="800" font-size="28" fill="#111">BookHook</text>
      </svg>
      <div id="rotTag" class="tag">Dream Big · Do Ridiculous · Achieve Remarkable</div>
    </section>

    <!-- How I’m feeling -->
    <section class="card">
      <h2>How I’m feeling</h2>
      <div class="row">
        <input id="freeMood" class="field" placeholder="I am feeling … (tired, anxious, pumped…)" />
        <button class="btn" onclick="mapFreeMood()">Set</button>
      </div>
      <div class="row">
        <span class="lbl">Level:</span>
        <div id="moodLvl" class="pills" aria-label="Mood level"></div>
      </div>
      <div class="muted">Type anything (“overwhelmed”, “hyped”) or tap a level. This nudges your matches.</div>
    </section>

    <!-- Desired Mood (chips) -->
    <section class="card">
      <h2>Desired Mood</h2>
      <div id="desired" class="pills" aria-label="What vibe you want from a book"></div>
      <div class="muted">Choose a few — these steer the match score in Discover.</div>
    </section>

    <!-- Discover (swipe) -->
    <section class="card" id="discover">
      <h2>Discover</h2>
      <div class="bar-mini" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
        <span class="tab">Swipe left: Want</span>
        <span class="tab">Swipe right: Reading</span>
        <span class="hint">Tap “Already read” to add HookMarks</span>
      </div>
      <div id="swipe" class="swipe"></div>
    </section>

    <!-- Small shelf note on home -->
    <section class="card" id="shelfSection">
      <h2>Your Shelf</h2>
      <div class="muted">Save or swipe to add books. Full list is in <a href="#profile" onclick="showSection('profile')">My Profile</a>.</div>
    </section>

    <!-- HookMarks (placeholder link) -->
    <section class="card" id="hookmarks" style="display:none">
      <h2>HookMarks</h2>
      <div class="muted">No HookMarks yet. Mark a book “Already read” and add one!</div>
    </section>

    <!-- Profile page (full shelf) -->
    <section class="card" id="profile" style="display:none">
      <h2>My Profile</h2>
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="muted"><b>Role:</b> <span id="profileRole">Reader</span> · <b>Points:</b> <span id="profilePts">0</span></div>
      </div>
      <div style="height:8px"></div>
      <h3>Your Bookshelf</h3>
      <div id="shelf" class="list muted">Save a book to see it here.</div>
    </section>

    <!-- Community / Leaders (basic placeholders) -->
    <section class="card" id="community" style="display:none"><h2>Community</h2><div class="muted">Coming soon.</div></section>
    <section class="card" id="leaders" style="display:none"><h2>Leaderboards</h2><div class="muted">Coming soon.</div></section>
  </main>

<script>
/* ---------- Rotating taglines ---------- */
const TAGS = [
  "Dream Big · Do Ridiculous · Achieve Remarkable",
  "Swipe books by how you want to feel",
  "Match readers ↔ authors by vibe",
  "Collect HookMarks for LOLs & AHAs",
  "Turn pages → real-world missions"
];
let tagIdx = 0;
function rotateTag(){
  const el = document.getElementById('rotTag'); if(!el) return;
  el.textContent = TAGS[tagIdx % TAGS.length];
  tagIdx++;
}
setInterval(rotateTag, 4000);

/* ---------- Inputs ---------- */
const MOOD_LEVELS = ["Low","Medium","High"];
const DESIRED = ["Restful","Reflective","Insightful","Empowering","Intriguing","Educational","Comedic","Silly","Inspiring","Arousing","Uplifting","Self-loving","Entrepreneurial"];

const MOOD_MAP = {
  low:["sad","down","tired","drained","anxious","overwhelmed","lonely","stressed","meh"],
  medium:["ok","fine","neutral","calm","grounded","chill","steady"],
  high:["happy","joyful","excited","energized","pumped","hyped","curious","inspired","motivated"]
};

const state = {
  moodLevel: new Set(),
  desired: new Set(),
  pts: Number(localStorage.getItem("bh_pts")||0),
  shelf: JSON.parse(localStorage.getItem("bh_shelf")||"[]"), // {id,title,author,image,status}
  order: []
};

document.addEventListener("DOMContentLoaded", () => {
  // top status
  document.getElementById("pts").textContent = state.pts + " pts";
  document.getElementById("profilePts").textContent = state.pts;

  renderPills("moodLvl", MOOD_LEVELS, state.moodLevel);
  renderPills("desired", DESIRED, state.desired);

  refreshMatches();   // builds state.order
  show(0);            // renders the first card
  renderShelf();      // profile shelf tiles
});

/* ---------- Helpers for sections ---------- */
function showSection(id){
  ["discover","hookmarks","profile","community","leaders"].forEach(s=>{
    const el = document.getElementById(s);
    if(el) el.style.display = (s===id) ? "" : "none";
  });
  if(id==="profile") renderShelf();
}

/* ---------- Pills ---------- */
function renderPills(containerId, items, set){
  const box = document.getElementById(containerId);
  box.innerHTML = "";
  items.forEach(name => {
    const b = document.createElement("button");
    b.className = "pill";
    b.textContent = name;
    b.addEventListener("click", () => {
      if(set.has(name)){ set.delete(name); b.classList.remove("on"); }
      else { set.add(name); b.classList.add("on"); }
      refreshMatches();
    });
    box.appendChild(b);
  });
}

/* free text → level */
function mapFreeMood(){
  const t = (document.getElementById("freeMood").value||"").toLowerCase().trim();
  if(!t) return;
  const hit = (arr)=>arr.some(w=>t.includes(w));
  state.moodLevel.clear();
  if(hit(MOOD_MAP.high)) state.moodLevel.add("High");
  else if(hit(MOOD_MAP.low)) state.moodLevel.add("Low");
  else state.moodLevel.add("Medium");
  // toggle pill UI
  document.querySelectorAll("#moodLvl .pill").forEach(p=>{
    p.classList.toggle("on", state.moodLevel.has(p.textContent));
  });
  refreshMatches();
}

/* ---------- Data: seed books (Ridiculous first) ---------- */
const BOOKS = [
  {
    id:"rid",
    title:"The Ridiculous: Book 1",
    author:"Jef & Mindy",
    vibes:["Funny","Satirical","Empowering","Chill","Feel-good"],
    facts:{pace:"Medium", pages:312, year:2024},
    gold:true,
    image:"https://m.media-amazon.com/images/I/81-BookCoverRidiculous.jpg", // placeholder; resolves if not valid
    links:{buy:"#", site:"#"}
  },
  {
    id:"mag",
    title:"Magical Adventures of Lori & Bonnie B. Bunny",
    author:"Elaine Blackstien",
    vibes:["Inspiring","Playful","Comedic","Uplifting"],
    facts:{pace:"Fast", pages:248, year:2025},
    image:"",
    links:{buy:"#"}
  },
  {
    id:"coz",
    title:"Star Soup & Cozy Skies",
    author:"L. Nova",
    vibes:["Calm","Cozy","Comforted","Reflective"],
    facts:{pace:"Slow", pages:220, year:2021},
    image:"",
    links:{buy:"#"}
  }
];

/* ---------- Matching ---------- */
function score(b){
  const inter = (arr,set)=>arr.filter(x=>set.has(x)).length;
  let s = inter(b.vibes||[], state.desired)*1.4;
  // very light mood-level nudge (High favors “Uplifting/Inspiring”, Low favors “Restful/Comforted” automatically via chosen chips)
  if(b.gold) s += 2.5;
  return s;
}
function refreshMatches(){
  state.order = [...BOOKS].sort((a,b)=>score(b)-score(a));
}

/* ---------- Swipe card ---------- */
function show(idx){
  // ensure we have something to show
  if(!state.order.length){
    document.getElementById("swipe").innerHTML = '<div class="muted">No books yet.</div>';
    return;
  }
  const b = state.order[idx%state.order.length];
  const el = document.getElementById("swipe");

  const chips = [
    ...(b.vibes||[]),
    b.facts?.pace,
    b.facts?.pages ? `${b.facts.pages}p` : null,
    b.facts?.year ? `Since ${b.facts.year}` : null
  ].filter(Boolean);

  const coverHTML = b.image
    ? `<div class="cover"><img src="${b.image}" alt="Cover of ${escapeHtml(b.title)}"></div>`
    : `<div class="cover" aria-hidden="true">${escapeHtml(b.title.slice(0,1))}</div>`;

  el.innerHTML = `
    <div id="swipeCard" class="card-gesture swipe">
      ${coverHTML}
      <div>
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            ${b.gold?'<span class="chip" style="background:#fff7cc;border-color:#E7C200">⭐ Featured</span>':''}
          </div>
          <div class="badge gold" id="ptsTop">${state.pts} pts</div>
        </div>
        <h2 style="margin:6px 0 4px">${escapeHtml(b.title)}</h2>
        <div class="muted">by ${escapeHtml(b.author)}</div>
        <div class="chips">${chips.map(c=>`<span class="chip">${escapeHtml(c)}</span>`).join('')}</div>
        <div class="actions">
          <button class="btn" onclick="want('${b.id}')">Want (+5)</button>
          <button class="btn gold" onclick="reading('${b.id}')">Reading (+7)</button>
          <button class="btn" onclick="already('${b.id}')">Already read</button>
        </div>
        <div class="divider"></div>
        <div class="muted">Author · ${escapeHtml(b.author)} ${b.links?.site?`· <a class="link" href="${b.links.site}">Website</a>`:''} ${b.links?.buy?`· <a class="link" href="${b.links.buy}">Buy</a>`:''}</div>

        <span class="badge-swipe like">SAVE</span>
        <span class="badge-swipe nope">NOPE</span>
      </div>
    </div>
  `;

  // add swipe behavior
  addSwipe(document.getElementById("swipeCard"),
           ()=>want(b.id),      // swipe left
           ()=>reading(b.id));  // swipe right

  // cover autofetch if missing
  if(!b.image && !b._coverRequested){
    b._coverRequested = true;
    resolveCover(b).then(url=>{
      if(url){
        b.image = url;
        const c = el.querySelector(".cover");
        if(c) c.innerHTML = `<img src="${url}" alt="Cover of ${escapeHtml(b.title)}">`;
      }
    });
  }
}

function addSwipe(el, onLeft, onRight){
  let startX = 0, dx = 0, dragging = false;
  const threshold = 80;
  const like = el.querySelector('.badge-swipe.like');
  const nope = el.querySelector('.badge-swipe.nope');

  const down = (e)=>{dragging=true;startX=(e.clientX ?? e.touches?.[0]?.clientX);el.style.transition=''};
  const move = (e)=>{
    if(!dragging) return;
    dx = (e.clientX ?? e.touches?.[0]?.clientX) - startX;
    const rot = dx/14;
    el.style.transform = `translateX(${dx}px) rotate(${rot}deg)`;
    const a = Math.min(1, Math.abs(dx)/120);
    if(dx>0){ if(like) like.style.opacity=a; if(nope) nope.style.opacity=0; }
    else    { if(nope) nope.style.opacity=a; if(like) like.style.opacity=0; }
  };
  const up = ()=>{
    if(!dragging) return; dragging=false;
    if(dx >  threshold){ el.style.transition='transform .2s'; el.style.transform='translateX(500px) rotate(15deg)'; setTimeout(onRight,160); }
    else if(dx < -threshold){ el.style.transition='transform .2s'; el.style.transform='translateX(-500px) rotate(-15deg)'; setTimeout(onLeft,160); }
    else { el.style.transition='transform .2s'; el.style.transform='translateX(0) rotate(0)'; if(like) like.style.opacity=0; if(nope) nope.style.opacity=0; }
  };
  el.addEventListener('pointerdown',down);
  el.addEventListener('pointermove',move);
  el.addEventListener('pointerup',up);
  el.addEventListener('pointercancel',up);
}

/* ---------- Actions ---------- */
function want(id){ saveToShelf(id,'want',5); pass(); }
function reading(id){ saveToShelf(id,'reading',7); pass(); }
function already(id){ saveToShelf(id,'read',10); alert("Great! Add a HookMark (LOL, AHA, Breakthrough) in HookMarks soon."); pass(); }

function pass(){ state.order.push(state.order.shift()); show(0); }

function saveToShelf(id,status,pts){
  const b = BOOKS.find(x=>x.id===id); if(!b) return;
  const existing = state.shelf.find(x=>x.id===id);
  if(existing){ existing.status = status; existing.image = existing.image || b.image || ""; }
  else state.shelf.unshift({id:b.id,title:b.title,author:b.author,image:b.image||"",status});
  localStorage.setItem("bh_shelf", JSON.stringify(state.shelf));
  renderShelf();
  addPts(pts);
}

function renderShelf(){
  const box = document.getElementById("shelf");
  if(!box) return;
  if(!state.shelf.length){ box.classList.add("muted"); box.textContent = "Save a book to see it here."; return; }
  box.classList.remove("muted");
  box.innerHTML = state.shelf.map(b=>`
    <div class="tile">
      <div class="thumb">${b.image?`<img src="${b.image}" alt="">`:""}</div>
      <div>
        <div><b>${escapeHtml(b.title)}</b></div>
        <div class="muted">by ${escapeHtml(b.author)}</div>
      </div>
      <span class="stat ${b.status}">${b.status}</span>
    </div>
  `).join("");
}

function addPts(n){
  state.pts += n;
  localStorage.setItem("bh_pts", state.pts);
  document.getElementById("pts").textContent = state.pts + " pts";
  const top = document.getElementById("ptsTop"); if(top) top.textContent = state.pts + " pts";
}

/* ---------- Cover auto-resolve ---------- */
async function resolveCover(book){
  try{
    const q = encodeURIComponent(`intitle:${book.title} inauthor:${book.author}`);
    const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${q}&maxResults=1`);
    if(res.ok){
      const data = await res.json();
      const img = data?.items?.[0]?.volumeInfo?.imageLinks?.thumbnail
               || data?.items?.[0]?.volumeInfo?.imageLinks?.smallThumbnail;
      if(img) return img.replace('http://','https://');
    }
  }catch(e){ console.warn("Cover lookup failed", e); }
  return null;
}

/* ---------- Utils ---------- */
function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]))}
</script>
</body>
</html>

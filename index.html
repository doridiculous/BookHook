<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookHook</title>

<!-- Inline CSS so styling ALWAYS loads -->
<style>
  :root{
    --bg:#fff; --fg:#111; --muted:#666;
    --line:#ececec; --card:#fff; --pill:#f6f6f6;
    --accent:#000; --accentfg:#fff; --gold:#E7C200;
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--fg);background:var(--bg)}
  .bar{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff}
  .brand{display:flex;gap:8px;align-items:center;font-weight:700}
  .dot{width:18px;height:18px;border-radius:6px;background:#000;display:inline-block}
  .status{display:flex;gap:8px;align-items:center}
  .badge{padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fafafa;font-weight:600;font-size:12px}
  .badge.gold{background:#fff7cc;border-color:#E7C200}
  .wrap{max-width:960px;margin:0 auto;padding:18px 14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 1px 10px rgba(0,0,0,.04)}
  h1,h2{margin:0 0 10px}
  .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0}
  .lbl{min-width:120px;color:var(--muted)}
  .pills{display:flex;flex-wrap:wrap;gap:8px}
  .pill{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#f6f6f6;cursor:pointer}
  .pill.on{background:#000;color:#fff;border-color:#000}
  .btn{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--accent);color:var(--accentfg)}
  .btn.gold{background:var(--gold);border-color:#caa900;color:#000}
  .muted{color:#666;font-size:14px}

  /* Swipe card */
  .swipe{display:grid;grid-template-columns:180px 1fr;gap:16px}
  @media (max-width:720px){.swipe{grid-template-columns:1fr}}
  .cover{width:100%;aspect-ratio:2/3;border-radius:10px;overflow:hidden;background:#ddd;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:48px}
  .cover img{width:100%;height:100%;object-fit:cover;display:block}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fafafa;font-size:13px}
  .actions{display:flex;gap:10px;margin-top:12px}
  .divider{height:1px;background:var(--line);margin:12px 0}
  .author{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .link{color:#0a66c2;text-decoration:none}
  .list{display:flex;flex-direction:column;gap:8px}

  /* Swipe interactions */
  .card-gesture{ position:relative; touch-action: pan-y; user-select:none; will-change: transform; }
  .badge-swipe{ position:absolute; top:10px; padding:6px 10px; border-radius:8px; font-weight:700; border:2px solid; background:rgba(255,255,255,.9); opacity:0; transition:opacity .15s ease; }
  .badge-swipe.like{ left:10px; color:#0a6a0a; border-color:#0a6a0a; }
  .badge-swipe.nope{ right:10px; color:#cc1b1b; border-color:#cc1b1b; }

  /* Inputs */
  .field{width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; font:inherit}
  .note{min-height:20px}
</style>
</head>
<body>
  <header class="bar">
    <div class="brand"><span class="dot"></span><span>BookHook</span></div>
    <div class="status"><span id="tier" class="badge">Bronze</span><span id="pts" class="badge gold">0 pts</span></div>
  </header>

  <main class="wrap">
    <!-- Your Profile -->
    <section class="card">
      <h2>Your Profile</h2>

      <div class="row">
        <label class="lbl">Mood Now</label>
        <div id="moodNowLevel" class="pills" aria-label="How you feel right now"></div>
      </div>

      <div class="row">
        <label class="lbl">Desired Read</label>
        <div id="desiredRead" class="pills" aria-label="What vibe you want from a book"></div>
      </div>

      <div class="row">
        <label class="lbl">Mood After</label>
        <div id="moodAfterLevel" class="pills" aria-label="How you feel after reading"></div>
      </div>

      <div class="muted">Tip: your choices power the matches below.</div>
    </section>

    <!-- SWIPE CARD -->
    <section class="card" id="swipeCard">
      <h2>Discover</h2>
      <div id="swipe" class="swipe"></div>
    </section>

    <!-- Share story -->
    <section class="card">
      <h2>Share Your Story</h2>
      <div class="muted" style="margin-bottom:8px">
        Tell us what changed for you after reading. Earn points when you share authentically.
      </div>
      <textarea id="reflectionText" class="field" rows="4" placeholder="What shifted for you? Any aha, laugh, calm moment…"></textarea>
      <div class="actions" style="margin-top:10px">
        <button class="btn" onclick="resetReflection()">Reset</button>
        <button class="btn gold" onclick="submitReflection()">Save reflection</button>
      </div>
      <div id="reflectionNote" class="note muted" style="margin-top:8px"></div>
    </section>

    <!-- Bookshelf -->
    <section class="card">
      <h2>Your Bookshelf</h2>
      <div id="shelf" class="list muted">Save a book to see it here.</div>
    </section>
  </main>

<!-- Inline JS so it ALWAYS runs -->
<script>
  /* Simple categories */
  const LEVELS = ["Low","Medium","High"];
  const DESIRED_READ = [
    "Restful","Reflective","Insightful","Empowering","Inspiring","Uplifting",
    "Comedic","Silly","Intriguing","Arousing","Self-loving","Educational"
  ];

  /* Book catalog (vibes + facts + tags) */
  const BOOKS = [
    {
      id:"rid",
      title:"The Ridiculous: Book 1",
      author:"Jef & Mindy",
      vibes:["Funny","Satirical","Empowering","Chill","Mindset-shifting"],
      facts:{pace:"Medium", pages:312, year:2024},
      gold:true,
      links:{buy:"#", site:"#"},
      tags:["Sci-Fi Comedy","Feel-good"]
    },
    {
      id:"hab",
      title:"Atomic Habits of the Heart",
      author:"A. North",
      vibes:["Focused","Grounded","Practical","Motivated","Calm"],
      facts:{pace:"Fast", pages:280, year:2019},
      links:{buy:"#"},
      tags:["Tiny steps","Habit loop"]
    },
    {
      id:"coz",
      title:"Star Soup & Cozy Skies",
      author:"L. Nova",
      vibes:["Calm","Cozy","Comforted","Reflective"],
      facts:{pace:"Slow", pages:220, year:2021},
      links:{buy:"#"},
      tags:["Soothing","Night read"]
    }
  ];

  /* App state */
  const state = {
    moodNowLevel: null,              // "Low" | "Medium" | "High"
    desiredRead: new Set(),          // choose 1–3 categories
    moodAfterLevel: null,
    pts: Number(localStorage.getItem("bh_pts")||0),
    shelf: JSON.parse(localStorage.getItem("bh_shelf")||"[]"),
    order: []
  };

  /* Init */
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("pts").textContent = state.pts + " pts";
    renderPillsSingle("moodNowLevel", LEVELS, (v)=>{ state.moodNowLevel=v; refreshMatches(); });
    renderPills("desiredRead", DESIRED_READ, state.desiredRead);
    renderPillsSingle("moodAfterLevel", LEVELS, (v)=>{ state.moodAfterLevel=v; });
    renderShelf();
    refreshMatches();
  });

  /* Render helpers */
  function renderPills(containerId, items, set){
    const box = document.getElementById(containerId);
    box.innerHTML = "";
    items.forEach(name => {
      const b = document.createElement("button");
      b.className = "pill";
      b.textContent = name;
      b.addEventListener("click", () => {
        if(set.has(name)){ set.delete(name); b.classList.remove("on"); }
        else { set.add(name); b.classList.add("on"); }
        refreshMatches();
      });
      box.appendChild(b);
    });
  }

  function renderPillsSingle(containerId, items, onPick){
    const box = document.getElementById(containerId);
    box.innerHTML = "";
    let current = null;
    items.forEach(name=>{
      const b = document.createElement("button");
      b.className = "pill";
      b.textContent = name;
      b.addEventListener("click", ()=>{
        if(current===name){ current=null; b.classList.remove("on"); onPick(null); return; }
        current = name;
        [...box.children].forEach(ch=>ch.classList.remove("on"));
        b.classList.add("on");
        onPick(name);
      });
      box.appendChild(b);
    });
  }

  function vibesFor(desired){
    const d = (desired||"").toLowerCase();
    if(d==="restful")      return ["Calm","Cozy","Chill","Comforted","Soothing","Gentle"];
    if(d==="reflective")   return ["Reflective","Mindful","Thoughtful","Introspective"];
    if(d==="insightful")   return ["Insightful","Wise","Practical","Aha","Mindset-shifting"];
    if(d==="empowering")   return ["Empowering","Confident","Motivated","Strong"];
    if(d==="inspiring")    return ["Inspiring","Inspired","Hopeful","Uplifted"];
    if(d==="uplifting")    return ["Uplifting","Joyful","Feel-good","Positive"];
    if(d==="comedic")      return ["Funny","Witty","Humorous","Laugh-out-loud","Satirical"];
    if(d==="silly")        return ["Silly","Absurd","Ridiculous","Playful"];
    if(d==="intriguing")   return ["Intriguing","Mysterious","Curious","Page-turning"];
    if(d==="arousing")     return ["Romantic","Sensual","Flirty"];
    if(d==="self-loving")  return ["Self-loving","Healing","Compassionate","Acceptance"];
    if(d==="educational")  return ["Educational","Practical","How-to","Skill"];
    return [];
  }

  /* Matching */
  function score(b){
    const want = [...state.desiredRead].flatMap(v=>vibesFor(v));
    const inter = (arr, setOrArray) => {
      const set = Array.isArray(setOrArray) ? new Set(setOrArray) : setOrArray;
      return (arr||[]).filter(x=>set.has(x)).length;
    };

    let s = inter(b.vibes||[], new Set(want)) * 1.6;

    // Extra softness if current mood is Low and the book is restful
    if(state.moodNowLevel==="Low"){
      const soothe = new Set(vibesFor("Restful"));
      s += inter(b.vibes||[], soothe) * 0.4;
    }

    if(b.gold) s += 2.0; // ⭐ Featured boost
    return s;
  }

  function refreshMatches(){
    state.order = [...BOOKS].sort((a,b)=>score(b)-score(a));
    show(0);
  }

  function show(idx){
    if(state.order.length===0){
      document.getElementById("swipe").innerHTML='<div class="muted">No books yet.</div>';
      return;
    }
    const b = state.order[idx%state.order.length];
    const el = document.getElementById("swipe");

    const chips = [
      ...(b.vibes||[]),
      b.facts?.pace,
      b.facts?.pages ? `${b.facts.pages}p` : null,
      b.facts?.year ? `Since ${b.facts.year}` : null,
      ...(b.tags||[])
    ].filter(Boolean);

    const coverHTML = b.image
      ? `<div class="cover"><img src="${b.image}" alt="Cover of ${escapeHtml(b.title)}"></div>`
      : `<div class="cover" aria-hidden="true">${b.title.slice(0,1)}</div>`;

    el.innerHTML = `
      <div id="card" class="card-gesture swipe">
        ${coverHTML}
        <div>
          <div class="row" style="justify-content:space-between;align-items:center">
            <div>
              <div class="muted">Match score: <b>${Math.round(score(b)*10)/10}</b></div>
              ${b.gold?'<span class="chip" style="background:#fff7cc;border-color:#E7C200">⭐ Featured</span>':''}
            </div>
            <div class="badge gold" id="ptsTop">${state.pts} pts</div>
          </div>
          <h2 style="margin:6px 0 4px">${escapeHtml(b.title)}</h2>
          <div class="muted">by ${escapeHtml(b.author)}</div>
          <div class="chips">${chips.map(c=>`<span class="chip">${escapeHtml(c)}</span>`).join('')}</div>
          <div class="actions">
            <button class="btn" onclick="pass()">Not for me</button>
            <button class="btn gold" onclick="saveBook('${b.id}')">Save (+5)</button>
          </div>
          <div class="divider"></div>
          <div class="author">
            <b>Author</b> · <span class="muted">${escapeHtml(b.author)}</span>
            ${b.links?.site?`· <a class="link" href="${b.links.site}">Website</a>`:''}
            ${b.links?.buy?`· <a class="link" href="${b.links.buy}">Buy</a>`:''}
          </div>
        </div>

        <span class="badge-swipe like">SAVE</span>
        <span class="badge-swipe nope">NOPE</span>
      </div>
    `;

    // make the card draggable
    addSwipe(document.getElementById('card'), ()=>pass(), ()=>saveBook(b.id));

    // auto-fetch cover if missing
    if(!b.image && !b._coverRequested){
      b._coverRequested = true;
      resolveCover(b).then(url=>{
        if(url){
          b.image = url;
          const imgWrap = el.querySelector(".cover");
          if(imgWrap){
            imgWrap.innerHTML = `<img src="${url}" alt="Cover of ${escapeHtml(b.title)}">`;
          }
        }
      });
    }
  }

  function addSwipe(el, onLeft, onRight){
    let startX = 0, dx = 0, dragging = false;
    const threshold = 80;
    const like = el.querySelector('.badge-swipe.like');
    const nope = el.querySelector('.badge-swipe.nope');

    const onDown = (e)=>{ dragging = true; startX = e.clientX ?? e.touches?.[0]?.clientX; el.style.transition=''; };
    const onMove = (e)=>{
      if(!dragging) return;
      const x = e.clientX ?? e.touches?.[0]?.clientX;
      dx = x - startX;
      const rot = dx/12;
      el.style.transform = `translateX(${dx}px) rotate(${rot}deg)`;
      const a = Math.min(1, Math.abs(dx)/120);
      if(dx>0){ if(like){ like.style.opacity = a; } if(nope){ nope.style.opacity = 0; } }
      else    { if(nope){ nope.style.opacity = a; } if(like){ like.style.opacity = 0; } }
    };
    const snap = ()=>{
      el.style.transition = 'transform .2s ease';
      el.style.transform = 'translateX(0) rotate(0)';
      if(like) like.style.opacity = 0;
      if(nope) nope.style.opacity = 0;
    };
    const onUp = ()=>{
      if(!dragging) return;
      dragging = false;
      if(dx >  threshold){ el.style.transition='transform .2s ease'; el.style.transform='translateX(500px) rotate(15deg)'; setTimeout(onRight, 160); }
      else if(dx < -threshold){ el.style.transition='transform .2s ease'; el.style.transform='translateX(-500px) rotate(-15deg)'; setTimeout(onLeft, 160); }
      else snap();
    };

    el.addEventListener('pointerdown', onDown);
    el.addEventListener('pointermove', onMove);
    el.addEventListener('pointerup', onUp);
    el.addEventListener('pointercancel', onUp);
  }

  /* Actions */
  function pass(){ state.order.push(state.order.shift()); show(0); }

  function saveBook(id){
    const book = BOOKS.find(x=>x.id===id);
    if(!book) return;
    if(!state.shelf.find(x=>x.id===id)){
      state.shelf.unshift({id:book.id,title:book.title,author:book.author});
      localStorage.setItem("bh_shelf", JSON.stringify(state.shelf));
      renderShelf();
      addPts(5);
    }
    pass();
  }

  function renderShelf(){
    const box = document.getElementById("shelf");
    if(!state.shelf.length){ box.textContent = "Save a book to see it here."; return; }
    box.classList.remove("muted");
    box.innerHTML = state.shelf.map(b=>`• <b>${escapeHtml(b.title)}</b> — ${escapeHtml(b.author)}`).join("<br>");
  }

  function addPts(n){
    state.pts += n;
    localStorage.setItem("bh_pts", state.pts);
    document.getElementById("pts").textContent = state.pts + " pts";
    const top = document.getElementById("ptsTop"); if(top) top.textContent = state.pts + " pts";
  }

  /* Reflection points */
  function resetReflection(){
    document.getElementById("reflectionText").value = "";
    document.getElementById("reflectionNote").textContent = "";
  }

  function submitReflection(){
    const note = document.getElementById("reflectionNote");
    const txt = (document.getElementById("reflectionText").value || "").trim();

    let points = 0;
    if(txt.length >= 1) points += 5;
    if(txt.length >= 40) points += 5;

    const idx = v => v ? ["Low","Medium","High"].indexOf(v) : -1;
    const before = idx(state.moodNowLevel);
    const after  = idx(state.moodAfterLevel);
    if(after > before && before >= 0) points += 10;

    if(points>0){
      addPts(points);
      note.textContent = `Nice! You earned +${points} pts for your reflection.`;
    }else{
      note.textContent = "Add a few words and set Mood Now/After to earn points.";
    }
  }

  /* Utils */
  async function resolveCover(book){
    try {
      const q = encodeURIComponent(`intitle:${book.title} inauthor:${book.author}`);
      const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${q}&maxResults=1`);
      if(res.ok){
        const data = await res.json();
        const img = data?.items?.[0]?.volumeInfo?.imageLinks?.thumbnail
                 || data?.items?.[0]?.volumeInfo?.imageLinks?.smallThumbnail;
        if(img) return img.replace('http://','https://');
      }
    } catch(e) { /* ignore */ }

    if(book.isbn){
      const url = `https://covers.openlibrary.org/b/isbn/${book.isbn}-L.jpg`;
      try {
        const head = await fetch(url, { method:'HEAD' });
        if(head.ok) return url;
      } catch(e) { /* ignore */ }
    }
    return null;
  }

  function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]))}
</script>
</body>
</html>

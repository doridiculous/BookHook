<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookHook</title>
<style>
:root{
  --bg:#f7f7f8; --fg:#111; --muted:#6b7280;
  --card:#fff; --line:#e5e7eb; --pill:#f5f5f5;
  --accent:#000; --accentfg:#fff; --gold:#E7C200;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:18px 14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 1px 8px rgba(0,0,0,.03)}
h1,h2{margin:0 0 10px}
.muted{color:var(--muted);font-size:14px}
.badge{padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;font-weight:600;font-size:12px}
.badge.gold{background:#fff7cc;border-color:#E7C200}
.btn{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
.btn.small{font-size:12px;padding:6px 10px}
.btn.gold{background:var(--gold);border-color:#caa900;color:#000}

/* top bar */
.bar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#fff;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:3}
.nav{display:flex;gap:8px;flex-wrap:wrap}

/* logo (center hero) */
.hero{display:flex;flex-direction:column;align-items:center;gap:8px;padding:22px 12px}
.logo{height:56px}
.logo-text{font-weight:800}

/* inputs */
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:8px 0}
.lbl{min-width:100px;color:var(--muted)}
.field{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font:inherit}
.pills{display:flex;flex-wrap:wrap;gap:8px}
.pill{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:var(--pill);cursor:pointer}
.pill.on{background:#111;color:#fff;border-color:#111}

/* discover swipe card */
.swipe{display:grid;grid-template-columns:210px 1fr;gap:16px}
@media (max-width:740px){.swipe{grid-template-columns:1fr}}
.cover{width:100%;aspect-ratio:2/3;border-radius:12px;overflow:hidden;background:#e5e7eb;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:48px}
.cover img{width:100%;height:100%;object-fit:cover;display:block}
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;align-items:center}
.chip{display:inline-flex;white-space:nowrap;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fafafa;font-size:13px}
.chips .chip:nth-of-type(n+7){display:none} /* show first 6 */
.chips .chip.more{display:inline-flex !important}
.hint{background:#fff7cc;border:1px solid #E7C200;padding:6px 10px;border-radius:999px;font-weight:600;font-size:12px}

/* swipe gestures */
.card-gesture{position:relative;touch-action:pan-y;user-select:none;will-change:transform}
.badge-swipe{position:absolute;top:10px;padding:6px 10px;border-radius:8px;font-weight:700;border:2px solid;background:rgba(255,255,255,.9);opacity:0;transition:opacity .15s}
.badge-swipe.like{left:10px;color:#0a6a0a;border-color:#0a6a0a}
.badge-swipe.nope{right:10px;color:#cc1b1b;border-color:#cc1b1b}

/* list tiles (shelf, hookmarks) */
.list{display:flex;flex-direction:column;gap:10px}
.tile{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;padding:10px;border:1px solid var(--line);border-radius:12px;background:#fff}
.tile .thumb{width:64px;height:96px;border-radius:8px;background:#eee;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}
.stat{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#f6f6f6;font-size:12px}
.stat.want{background:#eef3ff;border-color:#cfe1ff}
.stat.reading{background:#eaf8ed;border-color:#b8e4c3}
.stat.read{background:#fff0d2;border-color:#f7dc8a}

/* modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);padding:20px;z-index:10}
.modal .box{background:#fff;border-radius:14px;border:1px solid var(--line);max-width:560px;width:100%;padding:16px}
.modal.show{display:flex}

/* footer */
footer{padding:28px 14px;text-align:center;color:#666}
</style>
</head>
<body>

<!-- NAV -->
<header class="bar">
  <div class="nav">
    <button class="btn small" onclick="showSection('discover')">Discover</button>
    <button class="btn small" onclick="showSection('hookmarks')">HookMarks</button>
    <button class="btn small" onclick="showSection('profile')">My Profile</button>
    <button class="btn small" onclick="showSection('boards')">Leaderboards</button>
  </div>
  <div class="status"><span class="badge">Bronze</span><span id="pts" class="badge gold">0 pts</span></div>
</header>

<main class="wrap">

  <!-- HERO: simple black BOOK logo (embedded SVG) -->
  <section class="hero">
    <!-- black book icon -->
    <svg class="logo" viewBox="0 0 64 64" width="56" height="56" aria-label="BookHook">
      <!-- book block -->
      <rect x="8" y="8" width="48" height="48" rx="8" fill="#000"/>
      <!-- page edge suggestion -->
      <rect x="14" y="12" width="3" height="40" rx="1.5" fill="#fff"/>
    </svg>
    <div class="logo-text">BookHook</div>
  </section>

  <!-- ===== HOME / Discover ===== -->
  <section id="discover" class="page">

    <!-- How I’m feeling -->
    <section class="card">
      <h2>How I’m feeling</h2>
      <div class="row">
        <input id="moodFree" class="field" placeholder="I am feeling … (tired, anxious, pumped…)" />
        <button id="setMoodFree" class="btn small">Set</button>
      </div>
      <div class="row">
        <span class="lbl">Level:</span>
        <div class="pills">
          <button class="pill" onclick="setSingle('moodNowLevel','Low')">Low</button>
          <button class="pill" onclick="setSingle('moodNowLevel','Medium')">Medium</button>
          <button class="pill" onclick="setSingle('moodNowLevel','High')">High</button>
        </div>
      </div>
      <div class="muted">Type anything (“overwhelmed”, “hyped”) or tap a level. This nudges your matches.</div>
    </section>

    <!-- Desired Mood (categorized + impact-ordered; includes Entrepreneurial) -->
    <section class="card">
      <h2>Desired Mood</h2>
      <div class="row" id="desiredTabs"></div>
      <div class="pills" id="desiredPills"></div>
      <div class="muted">Choose a few — these steer the match score below.</div>
    </section>

    <!-- Discover swipe -->
    <section class="card" id="swipeCard">
      <h2>Discover</h2>
      <div class="muted" style="margin:-4px 0 10px">Swipe left: Want • Swipe right: Reading • Tap “Already read” to add HookMarks</div>
      <div id="swipe" class="swipe"></div>
    </section>

    <!-- Your Shelf (small callout; full list in profile) -->
    <section class="card" id="shelfSection">
      <h2>Your Shelf</h2>
      <div class="muted">Save or swipe to add books. Full list is in <a href="#profile" onclick="showSection('profile')">My Profile</a>.</div>
    </section>

  </section>

  <!-- ===== HookMarks ===== -->
  <section id="hookmarks" class="page" style="display:none">
    <section class="card">
      <h2>HookMarks</h2>
      <div class="row">
        <select id="hmFilter" class="field" style="max-width:260px">
          <option value="">All</option>
          <option value="lol">LOL</option>
          <option value="aha">Aha</option>
          <option value="brk">Breakthrough</option>
        </select>
        <button class="btn small" onclick="renderHookMarks()">Filter</button>
        <button class="btn small" onclick="clearHMFilter()">Clear</button>
      </div>
      <div id="hookList" class="list"></div>
    </section>
  </section>

  <!-- ===== Profile ===== -->
  <section id="profile" class="page" style="display:none">
    <section class="card">
      <h2>My Profile</h2>
      <div class="row">
        <span class="lbl">Role:</span>
        <label class="pill"><input type="checkbox" id="isReader" checked /> Reader</label>
        <label class="pill"><input type="checkbox" id="isAuthor" /> Author</label>
      </div>
      <div class="row"><span class="lbl">Points:</span> <b id="profilePts">0</b></div>
      <div class="row"><span class="lbl">HookMarks:</span> <b id="profileHooks">0</b></div>
    </section>

    <section class="card">
      <h3>Your Bookshelf</h3>
      <div id="shelf" class="list muted">Save a book to see it here.</div>
    </section>
  </section>

  <!-- ===== Leaderboards ===== -->
  <section id="boards" class="page" style="display:none">
    <section class="card">
      <h2>Leaderboards</h2>
      <div id="boardsWrap" class="list"></div>
    </section>
  </section>

</main>

<!-- FOOTER (bottom tagline as requested) -->
<footer>Dream Big • Do Ridiculous • Achieve Remarkable</footer>

<!-- HookMark modal -->
<div id="hmModal" class="modal" role="dialog" aria-modal="true" aria-label="Add HookMark">
  <div class="box">
    <h3 id="hmTitle">Add HookMark</h3>
    <div class="row"><span class="lbl">Mood before:</span>
      <div class="pills">
        <button class="pill" onclick="hmSet('before','Low')">Low</button>
        <button class="pill" onclick="hmSet('before','Medium')">Medium</button>
        <button class="pill" onclick="hmSet('before','High')">High</button>
      </div>
    </div>
    <div class="row"><span class="lbl">Mood after:</span>
      <div class="pills">
        <button class="pill" onclick="hmSet('after','Low')">Low</button>
        <button class="pill" onclick="hmSet('after','Medium')">Medium</button>
        <button class="pill" onclick="hmSet('after','High')">High</button>
      </div>
    </div>
    <div class="row"><span class="lbl">What sparked?</span>
      <label class="pill"><input type="checkbox" id="hmLol" /> LOL</label>
      <label class="pill"><input type="checkbox" id="hmAha" /> Aha</label>
      <label class="pill"><input type="checkbox" id="hmBrk" /> Breakthrough</label>
    </div>
    <textarea id="hmNote" class="field" rows="3" placeholder="What changed for you? (optional)"></textarea>
    <div class="row" style="justify-content:flex-end;gap:8px">
      <button class="btn" onclick="closeHM()">Cancel</button>
      <button class="btn gold" onclick="saveHM()">Save</button>
    </div>
  </div>
</div>

<script>
/* ---------------- DATA ---------------- */

// Desired mood categories (with Entrepreneurial). Items reorder over time by impact scores.
const MOOD_GROUPS_BASE = {
  "Calm / Steady":      ["Calm","Restful","Reflective","Grounding","Peaceful","Soothing"],
  "Clarity":            ["Clear-headed","Focused","Insightful","Mindset-shifting"],
  "Drive":              ["Motivated","Empowered","Productive","Entrepreneurial"],
  "Spark / Fun":        ["Playful","Silly","Comedic","Uplifting","Inspiring","Arousing"],
  "Comfort & Care":     ["Comforted","Self-loving","Grateful","Connected"]
};
// simple keyword map for free-text “How I’m feeling”
const MOOD_MAP = {
  low:["sad","down","tired","drained","anxious","overwhelmed","lonely","stressed","meh"],
  medium:["ok","fine","neutral","calm","grounded","chill","steady"],
  high:["happy","joyful","excited","energized","pumped","hyped","curious","inspired","motivated"]
};

// Seed books
const BOOKS = [
  { id:"rid", title:"The Ridiculous: Book 1", author:"Jef & Mindy",
    vibes:["Funny","Satirical","Empowering","Chill","Feel-good"],
    facts:{pace:"Medium", pages:312, year:2024}, gold:true, links:{site:"#",buy:"#"} },
  { id:"mag", title:"Magical Adventures of Lori & Bonnie B. Bunny", author:"Elaine Blackstien",
    vibes:["Inspiring","Playful","Comedic","Uplifting","Fast"], facts:{pace:"Fast", pages:248, year:2025},
    links:{buy:"#"} },
  { id:"hab", title:"Atomic Habits of the Heart", author:"A. North",
    vibes:["Focused","Grounded","Practical","Motivated","Calm"],
    facts:{pace:"Fast", pages:280, year:2019}, links:{buy:"#"} },
  { id:"coz", title:"Star Soup & Cozy Skies", author:"L. Nova",
    vibes:["Calm","Cozy","Comforted","Reflective"], facts:{pace:"Slow", pages:220, year:2021}, links:{buy:"#"} }
];

/* ---------------- STATE ---------------- */
const state = {
  moodNow:new Set(), moodNowLevel:null,
  desired:new Set(),
  pts:Number(localStorage.getItem('bh_pts')||0),
  shelf: JSON.parse(localStorage.getItem('bh_shelf')||"[]"), // {id,title,author,image,status}
  hookmarks: JSON.parse(localStorage.getItem('bh_hooks')||"[]"), // {id,bookId,ts,before,after,lol,aha,brk,note}
  impact: JSON.parse(localStorage.getItem('bh_impact')||"{}"), // mood->score
  order:[],
  activeBook:null
};

/* ---------------- INIT ---------------- */
document.addEventListener('DOMContentLoaded', async () => {
  document.getElementById('pts').textContent = state.pts + ' pts';
  renderDesiredTabs(); renderDesiredPills(); // categories
  document.getElementById('setMoodFree').addEventListener('click',()=>mapFreeMood(document.getElementById('moodFree').value));

  await prefetchCovers();           // fetch covers first
  refreshMatches();                 // sort order
  show(0);                          // render first card

  renderShelf();
  renderHookMarks();
  rebuildLeaderboards();
  updateStats();
});

/* ---------------- NAV SECTIONS ---------------- */
function showSection(id){
  for(const el of document.querySelectorAll('.page')) el.style.display='none';
  document.getElementById(id).style.display='';
  if(id==='hookmarks') renderHookMarks();
  if(id==='profile'){ renderShelf(); updateStats(); }
}

/* ---------------- DESIRED MOOD (categories, impact-ordered) ---------------- */
let activeGroup = Object.keys(MOOD_GROUPS_BASE)[0];

function impactSort(arr){
  // higher impact first (saved from HookMarks deltas)
  return [...arr].sort((a,b)=>(state.impact[b]||0)-(state.impact[a]||0));
}
function renderDesiredTabs(){
  const el = document.getElementById('desiredTabs');
  el.innerHTML = Object.keys(MOOD_GROUPS_BASE).map(g =>
    `<button class="pill ${g===activeGroup?'on':''}" onclick="setDesiredGroup('${g}')">${g}</button>`
  ).join('');
}
function setDesiredGroup(g){ activeGroup=g; renderDesiredTabs(); renderDesiredPills(); refreshMatches(); }
function renderDesiredPills(){
  const items = impactSort(MOOD_GROUPS_BASE[activeGroup]);
  const el = document.getElementById('desiredPills');
  el.innerHTML = items.map(name =>
    `<button class="pill ${state.desired.has(name)?'on':''}" onclick="toggleDesired('${name}')">${name}</button>`
  ).join('');
}
function toggleDesired(name){
  if(state.desired.has(name)) state.desired.delete(name); else state.desired.add(name);
  renderDesiredPills(); refreshMatches();
}

/* ---------------- MOOD FREE TEXT ---------------- */
function setSingle(containerId, value){ state[containerId]=value; refreshMatches(); }
function mapFreeMood(text){
  const t=(text||'').toLowerCase().trim(); if(!t) return;
  const hit = a=>a.some(w=>t.includes(w));
  if(hit(MOOD_MAP.high)) state.moodNowLevel='High';
  else if(hit(MOOD_MAP.low)) state.moodNowLevel='Low';
  else state.moodNowLevel='Medium';
  refreshMatches();
}

/* ---------------- COVERS ---------------- */
async function prefetchCovers(){
  // Try Google Books; if none, mark for skip
  await Promise.all(BOOKS.map(async b=>{
    if(b.image){b._hasImg=true;return;}
    try{
      const q = encodeURIComponent(`intitle:${b.title} inauthor:${b.author}`);
      const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${q}&maxResults=1`);
      if(res.ok){
        const data = await res.json();
        const img = data?.items?.[0]?.volumeInfo?.imageLinks?.thumbnail
                 || data?.items?.[0]?.volumeInfo?.imageLinks?.smallThumbnail;
        if(img){ b.image = img.replace('http://','https://'); b._hasImg=true; }
      }
    }catch(e){}
    if(!b.image) b._skip=true;
  }));
}

/* ---------------- MATCHING ---------------- */
function score(b){
  const inter=(arr,set)=>arr.filter(x=>set.has(x)).length;
  let s = inter(b.vibes||[], state.desired)*1.4;
  if(state.moodNowLevel==='Low')  s+=0.2;
  if(state.moodNowLevel==='High') s+=0.1;
  if(b.gold) s+=2.5;
  return s;
}
function refreshMatches(){
  const pool = BOOKS.filter(b=>!b._skip); // skip books with no cover
  state.order = pool.sort((a,b)=>score(b)-score(a));
}

/* ---------------- SWIPE CARD ---------------- */
function show(idx){
  if(!state.order.length){ document.getElementById('swipe').innerHTML='<div class="muted">No books yet.</div>'; return; }
  const b = state.order[idx%state.order.length];
  const el = document.getElementById('swipe');

  const rawChips = [
    ...(b.vibes||[]),
    b.facts?.pace,
    b.facts?.pages?`${b.facts.pages}p`:null,
    b.facts?.year?`Since ${b.facts.year}`:null
  ].filter(Boolean);
  const max=6;
  const chipsHtml = rawChips.slice(0,max).map(c=>`<span class="chip">${escapeHtml(c)}</span>`).join('')
                    +(rawChips.length>max?`<span class="chip more">+ ${rawChips.length-max} more</span>`:'');

  el.innerHTML = `
  <div id="card" class="card-gesture swipe">
    <div class="cover">${b.image?`<img src="${b.image}" alt="Cover of ${escapeHtml(b.title)}">`:escapeHtml(b.title.slice(0,1))}</div>
    <div>
      <div class="row" style="justify-content:space-between;align-items:center">
        <div>${b.gold?'<span class="badge gold">Featured</span>':''}</div>
        <div class="badge gold" id="ptsTop">${state.pts} pts</div>
      </div>
      <h2 style="margin:6px 0 4px">${escapeHtml(b.title)}</h2>
      <div class="muted">by ${escapeHtml(b.author)}</div>
      <div class="chips">${chipsHtml}</div>
      <div class="row" style="gap:8px;margin-top:10px">
        <button class="btn" onclick="markShelf('${b.id}','want')">Want (+5)</button>
        <button class="btn" onclick="markShelf('${b.id}','reading')">Reading (+7)</button>
        <button class="btn gold" onclick="startHookmark('${b.id}')">Already read</button>
      </div>
      <div class="row muted" style="margin-top:8px">Swipe: left = Want • right = Reading</div>
    </div>
    <span class="badge-swipe like">SAVE</span>
    <span class="badge-swipe nope">NOPE</span>
  </div>`;
  addSwipe(document.getElementById('card'), ()=>markShelf(b.id,'want'), ()=>markShelf(b.id,'reading'));
}

/* swipe logic */
function addSwipe(el,onLeft,onRight){
  let startX=0, dx=0, dragging=false; const like=el.querySelector('.badge-swipe.like'), nope=el.querySelector('.badge-swipe.nope');
  const onDown=e=>{dragging=true;startX=e.clientX??e.touches?.[0]?.clientX;el.style.transition='';};
  const onMove=e=>{ if(!dragging) return; const x=e.clientX??e.touches?.[0]?.clientX; dx=x-startX; el.style.transform=`translateX(${dx}px) rotate(${dx/12}deg)`; const a=Math.min(1,Math.abs(dx)/120); if(dx>0){like.style.opacity=a;nope.style.opacity=0;} else{nope.style.opacity=a;like.style.opacity=0;} };
  const snap=()=>{el.style.transition='transform .2s'; el.style.transform='translateX(0) rotate(0)'; like.style.opacity=0; nope.style.opacity=0;};
  const onUp=()=>{ if(!dragging) return; dragging=false; if(dx>80){el.style.transition='transform .2s'; el.style.transform='translateX(500px) rotate(15deg)'; setTimeout(onRight,160);} else if(dx<-80){el.style.transition='transform .2s'; el.style.transform='translateX(-500px) rotate(-15deg)'; setTimeout(onLeft,160);} else snap(); };
  el.addEventListener('pointerdown',onDown); el.addEventListener('pointermove',onMove); el.addEventListener('pointerup',onUp); el.addEventListener('pointercancel',onUp);
}

/* ---------------- SHELF ---------------- */
function markShelf(id,status){
  const b = BOOKS.find(x=>x.id===id); if(!b) return;
  const existing = state.shelf.find(x=>x.id===id);
  if(existing){ existing.status=status; }
  else{ state.shelf.unshift({id:b.id,title:b.title,author:b.author,image:b.image,status}); }
  localStorage.setItem('bh_shelf',JSON.stringify(state.shelf));
  addPts(status==='want'?5:7);
  renderShelf();
  // rotate
  state.order.push(state.order.shift());
  show(0);
}
function renderShelf(){
  const box = document.getElementById('shelf');
  if(!box) return;
  if(!state.shelf.length){ box.classList.add('muted'); box.innerHTML='Save a book to see it here.'; return; }
  box.classList.remove('muted');
  box.innerHTML = state.shelf.map(b=>`
    <div class="tile">
      <div class="thumb">${b.image?`<img src="${b.image}" alt="">`:''}</div>
      <div><div><b>${escapeHtml(b.title)}</b></div><div class="muted">by ${escapeHtml(b.author)}</div></div>
      <div class="stat ${b.status}">${b.status}</div>
    </div>`).join('');
}

/* ---------------- HOOKMARKS ---------------- */
function startHookmark(id){
  const b = BOOKS.find(x=>x.id===id); if(!b) return;
  state.activeBook=b;
  document.getElementById('hmTitle').textContent = `Add HookMark — ${b.title}`;
  document.getElementById('hmNote').value='';
  for(const k of ['hmLol','hmAha','hmBrk']) document.getElementById(k).checked=false;
  document.getElementById('hmModal').classList.add('show');
}
function hmSet(which,val){ state['hm_'+which]=val; }
function closeHM(){ document.getElementById('hmModal').classList.remove('show'); state.hm_before=null; state.hm_after=null; }
function saveHM(){
  const b=state.activeBook; if(!b) return;
  const entry={ id:String(Date.now()), bookId:b.id, ts:Date.now(),
    before:state.hm_before||'Medium', after:state.hm_after||'Medium',
    lol:document.getElementById('hmLol').checked?1:0,
    aha:document.getElementById('hmAha').checked?1:0,
    brk:document.getElementById('hmBrk').checked?1:0,
    note:document.getElementById('hmNote').value.trim()
  };
  state.hookmarks.unshift(entry);
  localStorage.setItem('bh_hooks',JSON.stringify(state.hookmarks));
  // impact learning: increase score for each selected desired mood by delta(before->after)
  const delta = levelToNum(entry.after)-levelToNum(entry.before);
  if(delta>0){
    state.desired.forEach(m=>{ state.impact[m]=(state.impact[m]||0)+delta; });
    localStorage.setItem('bh_impact',JSON.stringify(state.impact));
  }
  addPts(15);
  renderHookMarks(); rebuildLeaderboards(); updateStats();
  closeHM();
}
function levelToNum(v){ return v==='High'?3:(v==='Low'?1:2); }
function renderHookMarks(){
  const box=document.getElementById('hookList'); if(!box) return;
  const f=document.getElementById('hmFilter')?.value||'';
  const rows = state.hookmarks.filter(h=> !f || h[f]).map(h=>{
    const b = BOOKS.find(x=>x.id===h.bookId)||{};
    return `<div class="tile">
      <div class="thumb">${b.image?`<img src="${b.image}" alt="">`:''}</div>
      <div>
        <div><b>${escapeHtml(b.title||'Unknown')}</b> · <span class="muted">${new Date(h.ts).toLocaleDateString()}</span></div>
        <div class="chips">
          <span class="chip">Before: ${h.before}</span>
          <span class="chip">After: ${h.after}</span>
          ${h.lol?'<span class="chip">LOL</span>':''}
          ${h.aha?'<span class="chip">Aha</span>':''}
          ${h.brk?'<span class="chip">Breakthrough</span>':''}
        </div>
        ${h.note?`<div class="muted" style="margin-top:6px">${escapeHtml(h.note)}</div>`:''}
      </div>
      <div></div>
    </div>`;
  });
  box.innerHTML = rows.join('') || '<div class="muted">No HookMarks yet. Mark a book “Already read” to add one!</div>';
}
function clearHMFilter(){ const s=document.getElementById('hmFilter'); if(s){s.value='';} renderHookMarks(); }

/* ---------------- LEADERBOARDS (very simple demo) ---------------- */
function rebuildLeaderboards(){
  // author impact counts from HookMarks
  const map={}; // author -> {lol,aha,brk}
  state.hookmarks.forEach(h=>{
    const b = BOOKS.find(x=>x.id===h.bookId); if(!b) return;
    const k=b.author;
    map[k]=map[k]||{lol:0,aha:0,brk:0};
    map[k].lol+=h.lol; map[k].aha+=h.aha; map[k].brk+=h.brk;
  });
  const rows = Object.entries(map).map(([name,c])=>({
    name, score:c.lol+c.aha*2+c.brk*3, lol:c.lol, aha:c.aha, brk:c.brk
  })).sort((a,b)=>b.score-a.score);

  const el = document.getElementById('boardsWrap'); if(!el) return;
  el.innerHTML = rows.map(r=>`
    <div class="tile">
      <div class="thumb"></div>
      <div><b>${escapeHtml(r.name)}</b><div class="muted">LOL ${r.lol} · Aha ${r.aha} · Breakthrough ${r.brk}</div></div>
      <div class="stat read">Score ${r.score}</div>
    </div>`).join('') || '<div class="muted">No entries yet.</div>';
}

/* ---------------- POINTS / STATS ---------------- */
function addPts(n){
  state.pts+=n; localStorage.setItem('bh_pts',state.pts);
  document.getElementById('pts').textContent = state.pts+' pts';
  const top=document.getElementById('ptsTop'); if(top) top.textContent = state.pts+' pts';
  document.getElementById('profilePts')?.innerText = state.pts;
}
function updateStats(){
  document.getElementById('profilePts')?.innerText = state.pts;
  document.getElementById('profileHooks')?.innerText = state.hookmarks.length;
}

/* ---------------- UTILS ---------------- */
function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]))}
</script>
</body>
</html>

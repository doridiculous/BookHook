<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BookHook</title>

<!-- Inline CSS so styling ALWAYS loads -->
<style>
  :root{
    --bg:#fff; --fg:#111; --muted:#666;
    --line:#ececec; --card:#fff; --pill:#f6f6f6;
    --accent:#000; --accentfg:#fff; --gold:#E7C200;
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--fg);background:var(--bg)}
  .bar{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff}
  .brand{display:flex;gap:8px;align-items:center;font-weight:700}
  .dot{width:18px;height:18px;border-radius:6px;background:#000;display:inline-block}
  .status{display:flex;gap:8px;align-items:center}
  .badge{padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#fafafa;font-weight:600;font-size:12px}
  .badge.gold{background:#fff7cc;border-color:#E7C200}
  .wrap{max-width:960px;margin:0 auto;padding:18px 14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 1px 10px rgba(0,0,0,.04)}
  h1,h2{margin:0 0 10px}
  .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0}
  .lbl{min-width:120px;color:var(--muted)}
  .pills{display:flex;flex-wrap:wrap;gap:8px}
  .pill{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#f6f6f6;cursor:pointer}
  .pill.on{background:#000;color:#fff;border-color:#000}
  .btn{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--accent);color:var(--accentfg)}
  .btn.gold{background:var(--gold);border-color:#caa900;color:#000}
  .muted{color:#666;font-size:14px}

  /* Swipe card */
  .swipe{display:grid;grid-template-columns:180px 1fr;gap:16px}
  @media (max-width:720px){.swipe{grid-template-columns:1fr}}
  .cover{width:100%;aspect-ratio:2/3;border-radius:10px;background:#ddd;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:48px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fafafa;font-size:13px}
  .actions{display:flex;gap:10px;margin-top:12px}
  .divider{height:1px;background:var(--line);margin:12px 0}
  .author{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .link{color:#0a66c2;text-decoration:none}
  .list{display:flex;flex-direction:column;gap:8px}
</style>
</head>
<body>
  <header class="bar">
    <div class="brand"><span class="dot"></span><span>BookHook</span></div>
    <div class="status"><span id="tier" class="badge">Bronze</span><span id="pts" class="badge gold">0 pts</span></div>
  </header>

  <main class="wrap">
    <!-- Your Profile -->
    <section class="card">
      <h2>Your Profile</h2>

      <div class="row">
        <label class="lbl">Mood now</label>
        <div id="moodNow" class="pills" aria-label="Select your current mood"></div>
      </div>

      <div class="row">
        <label class="lbl">Desired emotions</label>
        <div id="desired" class="pills" aria-label="Select desired emotions"></div>
      </div>

      <div class="row">
        <label class="lbl">Growth categories</label>
        <div id="growth" class="pills" aria-label="Select growth areas"></div>
      </div>

      <div class="muted">Tip: your choices power the matches below.</div>
    </section>

    <!-- SWIPE CARD -->
    <section class="card" id="swipeCard">
      <h2>Discover</h2>
      <div id="swipe" class="swipe"></div>
    </section>

    <!-- Bookshelf -->
    <section class="card">
      <h2>Your Bookshelf</h2>
      <div id="shelf" class="list muted">Save a book to see it here.</div>
    </section>
  </main>

<!-- Inline JS so it ALWAYS runs -->
<script>
  /** Data **/
  const MOODS   = ["Calm","Inspired","Hopeful","Energized","Cozy","Focused","Grounded","Joyful"];
  const DESIRED = ["Calm","Hopeful","Motivated","Curious","Comforted","Focused","Joyful"];
  const GROWTH  = ["mental","spiritual","emotional","functional","financial","social"];

  // Seed books (you can add more later)
  const BOOKS = [
    {
      id:"rid",
      title:"The Ridiculous: Book 1",
      author:"J. Kippel & M. Blackstien",
      moods:["Inspired","Hopeful","Joyful"],
      goals:["emotional","functional","social"],
      facts:{pace:"Medium", pages:312, year:2024},
      gold:true, // priority boost
      links:{buy:"#", site:"#"},
      tags:["Do Ridiculous","BodyProud","Mission-ready"]
    },
    {
      id:"hab",
      title:"Atomic Habits of the Heart",
      author:"A. North",
      moods:["Focused","Grounded","Calm"],
      goals:["mental","functional"],
      facts:{pace:"Fast", pages:280, year:2019},
      links:{buy:"#"},
      tags:["Tiny steps","Practical","Habit loop"]
    },
    {
      id:"coz",
      title:"Star Soup & Cozy Skies",
      author:"L. Nova",
      moods:["Calm","Cozy","Comforted"],
      goals:["spiritual","emotional","sleep"],
      facts:{pace:"Slow", pages:220, year:2021},
      links:{buy:"#"},
      tags:["Soothing","Night read"]
    }
  ];

  /** State **/
  const state = {
    moodNow: new Set(),
    desired: new Set(),
    growth: new Set(),
    pts: Number(localStorage.getItem("bh_pts")||0),
    shelf: JSON.parse(localStorage.getItem("bh_shelf")||"[]"),
    order: [] // will hold sorted books
  };

  /** Init **/
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("pts").textContent = state.pts + " pts";
    renderPills("moodNow", MOODS, state.moodNow);
    renderPills("desired", DESIRED, state.desired);
    renderPills("growth", GROWTH, state.growth);
    renderShelf();
    refreshMatches(); // show first card immediately
  });

  /** UI helpers **/
  function renderPills(containerId, items, set){
    const box = document.getElementById(containerId);
    box.innerHTML = "";
    items.forEach(name => {
      const b = document.createElement("button");
      b.className = "pill";
      b.textContent = name;
      b.addEventListener("click", () => {
        if(set.has(name)){ set.delete(name); b.classList.remove("on"); }
        else { set.add(name); b.classList.add("on"); }
        refreshMatches();
      });
      box.appendChild(b);
    });
  }

  /** Matching **/
  function score(b){
    const inter = (arr,set)=>arr.filter(x=>set.has(x)).length;
    let s = inter(b.moods, state.desired)*1.2 +
            inter(b.moods, state.moodNow)*0.6 +
            inter(b.goals??[], state.growth)*0.9;
    if(b.gold) s += 2.5; // Do Ridiculous priority
    return s;
  }

  function refreshMatches(){
    state.order = [...BOOKS].sort((a,b)=>score(b)-score(a));
    show(0);
  }

  function show(idx){
    if(state.order.length===0){ document.getElementById("swipe").innerHTML='<div class="muted">No books yet.</div>'; return; }
    const b = state.order[idx%state.order.length];
    const el = document.getElementById("swipe");
    const chips = [
      ...(b.tags||[]),
      ...b.moods,
      b.facts?.pace, b.facts?.pages?`${b.facts.pages}p`:null, b.facts?.year?`Since ${b.facts.year}`:null
    ].filter(Boolean);
    el.innerHTML = `
      <div class="cover" aria-hidden="true">${b.title.slice(0,1)}</div>
      <div>
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <div class="muted">Match score: <b>${Math.round(score(b)*10)/10}</b></div>
            ${b.gold?'<span class="chip" style="background:#fff7cc;border-color:#E7C200">ðŸ‘‘ Do Ridiculous Priority</span>':''}
          </div>
          <div class="badge gold" id="ptsTop">${state.pts} pts</div>
        </div>
        <h2 style="margin:6px 0 4px">${escapeHtml(b.title)}</h2>
        <div class="muted">by ${escapeHtml(b.author)}</div>
        <div class="chips">${chips.map(c=>`<span class="chip">${escapeHtml(c)}</span>`).join('')}</div>
        <div class="actions">
          <button class="btn" onclick="pass()">Not for me</button>
          <button class="btn gold" onclick="saveBook('${b.id}')">Save (+5)</button>
        </div>
        <div class="divider"></div>
        <div class="author">
          <b>Author</b> Â· <span class="muted">${escapeHtml(b.author)}</span>
          ${b.links?.site?`Â· <a class="link" href="${b.links.site}">Website</a>`:''}
          ${b.links?.buy?`Â· <a class="link" href="${b.links.buy}">Buy</a>`:''}
        </div>
      </div>
    `;
  }

  /** Actions **/
  function pass(){
    // rotate list: move first to end and show next
    state.order.push(state.order.shift());
    show(0);
  }

  function saveBook(id){
    const book = BOOKS.find(x=>x.id===id);
    if(!book) return;
    if(!state.shelf.find(x=>x.id===id)){
      state.shelf.unshift({id:book.id,title:book.title,author:book.author});
      localStorage.setItem("bh_shelf", JSON.stringify(state.shelf));
      renderShelf();
      addPts(5);
    }
    pass();
  }

  function renderShelf(){
    const box = document.getElementById("shelf");
    if(!state.shelf.length){ box.textContent = "Save a book to see it here."; return; }
    box.classList.remove("muted");
    box.innerHTML = state.shelf.map(b=>`â€¢ <b>${escapeHtml(b.title)}</b> â€” ${escapeHtml(b.author)}`).join("<br>");
  }

  function addPts(n){
    state.pts += n;
    localStorage.setItem("bh_pts", state.pts);
    document.getElementById("pts").textContent = state.pts + " pts";
    const top = document.getElementById("ptsTop"); if(top) top.textContent = state.pts + " pts";
  }

  /** Utils **/
  function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[m]))}
</script>
</body>
</html>
